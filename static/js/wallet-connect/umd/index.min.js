!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WalletConnectClient",[],t):"object"==typeof exports?exports.WalletConnectClient=t():e.WalletConnectClient=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=91)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"g",(function(){return a})),n.d(t,"f",(function(){return u})),n.d(t,"n",(function(){return d})),n.d(t,"o",(function(){return l})),n.d(t,"j",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"m",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"k",(function(){return r})),n.d(t,"l",(function(){return i})),n.d(t,"d",(function(){return E})),n.d(t,"c",(function(){return y})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return v}));const r=0,i=512,o=256,s=256,c="AES-CBC",a="SHA-"+o,u="HMAC",d="SHA-256",l="SHA-512",f=32,h=16,p=32,g="Bad MAC",E="encrypt",y="decrypt",_="sign",v="verify"},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"bufferToArray",(function(){return c})),n.d(t,"bufferToHex",(function(){return a})),n.d(t,"bufferToUtf8",(function(){return u})),n.d(t,"bufferToNumber",(function(){return d})),n.d(t,"bufferToBinary",(function(){return l})),n.d(t,"arrayToBuffer",(function(){return f})),n.d(t,"arrayToHex",(function(){return h})),n.d(t,"arrayToUtf8",(function(){return p})),n.d(t,"arrayToNumber",(function(){return g})),n.d(t,"arrayToBinary",(function(){return E})),n.d(t,"hexToBuffer",(function(){return y})),n.d(t,"hexToArray",(function(){return _})),n.d(t,"hexToUtf8",(function(){return v})),n.d(t,"hexToNumber",(function(){return R})),n.d(t,"hexToBinary",(function(){return m})),n.d(t,"utf8ToBuffer",(function(){return S})),n.d(t,"utf8ToArray",(function(){return T})),n.d(t,"utf8ToHex",(function(){return O})),n.d(t,"utf8ToNumber",(function(){return N})),n.d(t,"utf8ToBinary",(function(){return b})),n.d(t,"numberToBuffer",(function(){return I})),n.d(t,"numberToArray",(function(){return w})),n.d(t,"numberToHex",(function(){return A})),n.d(t,"numberToUtf8",(function(){return P})),n.d(t,"numberToBinary",(function(){return C})),n.d(t,"binaryToBuffer",(function(){return U})),n.d(t,"binaryToArray",(function(){return L})),n.d(t,"binaryToHex",(function(){return D})),n.d(t,"binaryToUtf8",(function(){return x})),n.d(t,"binaryToNumber",(function(){return M})),n.d(t,"isBinaryString",(function(){return q})),n.d(t,"isHexString",(function(){return j})),n.d(t,"isBuffer",(function(){return H})),n.d(t,"isTypedArray",(function(){return V})),n.d(t,"isArrayBuffer",(function(){return K})),n.d(t,"getType",(function(){return G})),n.d(t,"getEncoding",(function(){return B})),n.d(t,"concatBuffers",(function(){return k})),n.d(t,"concatArrays",(function(){return Y})),n.d(t,"trimLeft",(function(){return J})),n.d(t,"trimRight",(function(){return F})),n.d(t,"calcByteLength",(function(){return z})),n.d(t,"splitBytes",(function(){return X})),n.d(t,"swapBytes",(function(){return W})),n.d(t,"swapHex",(function(){return Q})),n.d(t,"sanitizeBytes",(function(){return $})),n.d(t,"padLeft",(function(){return Z})),n.d(t,"padRight",(function(){return ee})),n.d(t,"removeHexPrefix",(function(){return te})),n.d(t,"addHexPrefix",(function(){return ne})),n.d(t,"sanitizeHex",(function(){return re})),n.d(t,"removeHexLeadingZeros",(function(){return ie}));var r=n(36),i=n.n(r),o=n(87),s=n.n(o);function c(e){return new Uint8Array(e)}function a(e,t=!1){const n=e.toString("hex");return t?ne(n):n}function u(e){return e.toString("utf8")}function d(e){return e.readUIntBE(0,e.length)}function l(e){return E(c(e))}function f(e){return s()(e)}function h(e,t=!1){return a(f(e),t)}function p(e){return u(f(e))}function g(e){return d(f(e))}function E(e){return Array.from(e).map(C).join("")}function y(t){return e.from(te(t),"hex")}function _(e){return c(y(e))}function v(e){return u(y(e))}function R(e){return g(_(e))}function m(e){return E(_(e))}function S(t){return e.from(t,"utf8")}function T(e){return c(S(e))}function O(e,t=!1){return a(S(e),t)}function N(e){const t=parseInt(e,10);return function(e,t){if(!e)throw new Error(t)}(!function(e){return void 0===e}(t),"Number can only safely store up to 53 bits"),t}function b(e){return E(T(e))}function I(e){return U(C(e))}function w(e){return L(C(e))}function A(e,t){return D(C(e),t)}function P(e){return""+e}function C(e){return $((e>>>0).toString(2))}function U(e){return f(L(e))}function L(e){return new Uint8Array(X(e).map(e=>parseInt(e,2)))}function D(e,t){return h(L(e),t)}function x(e){return p(L(e))}function M(e){return g(L(e))}function q(e){return!("string"!=typeof e||!new RegExp(/^[01]+$/).test(e))&&e.length%8==0}function j(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function H(t){return e.isBuffer(t)}function V(e){return i.a.strict(e)&&!H(e)}function K(e){return!V(e)&&!H(e)&&void 0!==e.byteLength}function G(e){return H(e)?"buffer":V(e)?"typed-array":K(e)?"array-buffer":Array.isArray(e)?"array":typeof e}function B(e){return q(e)?"binary":j(e)?"hex":"utf8"}function k(...t){return e.concat(t)}function Y(...e){let t=[];return e.forEach(e=>t=t.concat(Array.from(e))),new Uint8Array([...t])}function J(e,t){const n=e.length-t;return n>0&&(e=e.slice(n)),e}function F(e,t){return e.slice(0,t)}function z(e,t=8){const n=e%t;return n?(e-n)/t*t+t:e}function X(e,t=8){const n=$(e).match(new RegExp(`.{${t}}`,"gi"));return Array.from(n||[])}function W(e){return X(e).map(oe).join("")}function Q(e){return D(W(m(e)))}function $(e,t=8,n="0"){return Z(e,z(e.length,t),n)}function Z(e,t,n="0"){return se(e,t,!0,n)}function ee(e,t,n="0"){return se(e,t,!1,n)}function te(e){return e.replace(/^0x/,"")}function ne(e){return e.startsWith("0x")?e:"0x"+e}function re(e){return(e=$(e=te(e),2))&&(e=ne(e)),e}function ie(e){const t=e.startsWith("0x");return e=(e=te(e)).startsWith("0")?e.substring(1):e,t?ne(e):e}function oe(e){return e.split("").reverse().join("")}function se(e,t,n,r="0"){const i=t-e.length;let o=e;if(i>0){const t=r.repeat(i);o=n?t+e:e+t}return o}}.call(this,n(69).Buffer)},function(e,t,n){"use strict";n.r(t);var r=n(41);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(26);n.d(t,"IEvents",(function(){return o.a}));var s=n(42);n.d(t,"IJsonRpcConnection",(function(){return s.b})),n.d(t,"IBaseJsonRpcProvider",(function(){return s.a})),n.d(t,"IJsonRpcProvider",(function(){return s.c}));var c=n(43);for(var i in c)["default","IEvents","IJsonRpcConnection","IBaseJsonRpcProvider","IJsonRpcProvider"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i)},function(e,t,n){"use strict";var r=n(59);n.d(t,"randomBytes",(function(){return r.a}));var i=n(61);n.d(t,"aesCbcDecrypt",(function(){return i.a})),n.d(t,"aesCbcEncrypt",(function(){return i.b}));var o=n(62);n.d(t,"hmacSha256Sign",(function(){return o.a})),n.d(t,"hmacSha256Verify",(function(){return o.b}));var s=n(67);n.d(t,"sha256",(function(){return s.a})),n.d(t,"sha512",(function(){return s.b}));var c=n(27);n.o(c,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return c.ERROR_BAD_MAC})),n.o(c,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return c.IV_LENGTH})),n.o(c,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return c.KEY_LENGTH})),n.o(c,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return c.LENGTH_0})),n.o(c,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return c.MAC_LENGTH})),n.o(c,"assert")&&n.d(t,"assert",(function(){return c.assert})),n.o(c,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return c.decryptWithSharedKey})),n.o(c,"derive")&&n.d(t,"derive",(function(){return c.derive})),n.o(c,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return c.encryptWithSharedKey})),n.o(c,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return c.generateKeyPair}));var a=n(0);n.d(t,"ERROR_BAD_MAC",(function(){return a.e})),n.d(t,"IV_LENGTH",(function(){return a.i})),n.d(t,"KEY_LENGTH",(function(){return a.j})),n.d(t,"LENGTH_0",(function(){return a.k})),n.d(t,"MAC_LENGTH",(function(){return a.m}))},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"g",(function(){return a})),n.d(t,"f",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return l}));const r="PARSE_ERROR",i="INVALID_REQUEST",o="METHOD_NOT_FOUND",s="INVALID_PARAMS",c="INTERNAL_ERROR",a="SERVER_ERROR",u=[-32700,-32600,-32601,-32602,-32603],d=[-32e3,-32099],l={[r]:{code:-32700,message:"Parse error"},[i]:{code:-32600,message:"Invalid Request"},[o]:{code:-32601,message:"Method not found"},[s]:{code:-32602,message:"Invalid params"},[c]:{code:-32603,message:"Internal error"},[a]:{code:-32e3,message:"Server error"}}},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return i})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return c})),n.d(t,"__param",(function(){return a})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return d})),n.d(t,"__generator",(function(){return l})),n.d(t,"__createBinding",(function(){return f})),n.d(t,"__exportStar",(function(){return h})),n.d(t,"__values",(function(){return p})),n.d(t,"__read",(function(){return g})),n.d(t,"__spread",(function(){return E})),n.d(t,"__spreadArrays",(function(){return y})),n.d(t,"__await",(function(){return _})),n.d(t,"__asyncGenerator",(function(){return v})),n.d(t,"__asyncDelegator",(function(){return R})),n.d(t,"__asyncValues",(function(){return m})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return T})),n.d(t,"__importDefault",(function(){return O})),n.d(t,"__classPrivateFieldGet",(function(){return N})),n.d(t,"__classPrivateFieldSet",(function(){return b}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function c(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function a(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function f(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}function h(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function y(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,c=o.length;s<c;s++,i++)r[i]=o[s];return r}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||c(e,t)}))})}function c(e,t){try{(n=i[e](t)).value instanceof _?Promise.resolve(n.value.v).then(a,u):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function a(e){c("next",e)}function u(e){c("throw",e)}function d(e,t){e(t),o.shift(),o.length&&c(o[0][0],o[0][1])}}function R(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:_(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function m(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=p(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function O(e){return e&&e.__esModule?e:{default:e}}function N(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function b(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(99),t),i(n(100),t)},function(e,t,n){"use strict";function r(e,t,n="string"){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function i(e,t,n){return!!(!n.length?function(e,t){return Array.isArray(e)?e.length===t:Object.keys(e).length===t}(e,t.length):function(e,t){return Array.isArray(e)?e.length>=t:Object.keys(e).length>=t}(e,t.length))&&function(e,t){let n=!0;return t.forEach(t=>{t in e||(n=!1)}),n}(e,t)}function o(e,t,n="_"){const r=e.split(n);return r[r.length-1].trim().toLowerCase()===t.trim().toLowerCase()}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}))},function(e,t,n){"use strict";n.r(t);var r=n(4);n.d(t,"PARSE_ERROR",(function(){return r.e})),n.d(t,"INVALID_REQUEST",(function(){return r.c})),n.d(t,"METHOD_NOT_FOUND",(function(){return r.d})),n.d(t,"INVALID_PARAMS",(function(){return r.b})),n.d(t,"INTERNAL_ERROR",(function(){return r.a})),n.d(t,"SERVER_ERROR",(function(){return r.g})),n.d(t,"RESERVED_ERROR_CODES",(function(){return r.f})),n.d(t,"SERVER_ERROR_CODE_RANGE",(function(){return r.h})),n.d(t,"STANDARD_ERROR_MAP",(function(){return r.i}));var i=n(20);n.d(t,"isServerErrorCode",(function(){return i.d})),n.d(t,"isReservedErrorCode",(function(){return i.c})),n.d(t,"isValidErrorCode",(function(){return i.e})),n.d(t,"getError",(function(){return i.a})),n.d(t,"getErrorByCode",(function(){return i.b})),n.d(t,"validateJsonRpcError",(function(){return i.g})),n.d(t,"parseConnectionError",(function(){return i.f}));var o=n(73);for(var s in o)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var c=n(74);n.d(t,"payloadId",(function(){return c.e})),n.d(t,"formatJsonRpcRequest",(function(){return c.c})),n.d(t,"formatJsonRpcResult",(function(){return c.d})),n.d(t,"formatJsonRpcError",(function(){return c.b})),n.d(t,"formatErrorMessage",(function(){return c.a}));var a=n(75);n.d(t,"isValidRoute",(function(){return a.c})),n.d(t,"isValidDefaultRoute",(function(){return a.a})),n.d(t,"isValidWildcardRoute",(function(){return a.e})),n.d(t,"isValidLeadingWildcardRoute",(function(){return a.b})),n.d(t,"isValidTrailingWildcardRoute",(function(){return a.d}));var u=n(76);for(var s in u)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError","payloadId","formatJsonRpcRequest","formatJsonRpcResult","formatJsonRpcError","formatErrorMessage","isValidRoute","isValidDefaultRoute","isValidWildcardRoute","isValidLeadingWildcardRoute","isValidTrailingWildcardRoute"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(s);var d=n(77);n.d(t,"isHttpUrl",(function(){return d.a})),n.d(t,"isWsUrl",(function(){return d.c})),n.d(t,"isLocalhostUrl",(function(){return d.b}));var l=n(78);n.d(t,"isJsonRpcPayload",(function(){return l.b})),n.d(t,"isJsonRpcRequest",(function(){return l.c})),n.d(t,"isJsonRpcResponse",(function(){return l.d})),n.d(t,"isJsonRpcResult",(function(){return l.e})),n.d(t,"isJsonRpcError",(function(){return l.a})),n.d(t,"isJsonRpcValidationInvalid",(function(){return l.f}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);r.__exportStar(n(118),t),r.__exportStar(n(119),t),r.__exportStar(n(120),t),r.__exportStar(n(121),t),r.__exportStar(n(122),t),r.__exportStar(n(123),t),r.__exportStar(n(124),t),r.__exportStar(n(125),t),r.__exportStar(n(126),t),r.__exportStar(n(127),t),r.__exportStar(n(128),t),r.__exportStar(n(129),t),r.__exportStar(n(130),t),r.__exportStar(n(18),t)},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,i,{once:!0})}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var a=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,s,c;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=d(e))>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,c=a,console&&console.warn&&console.warn(c)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):E(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function E(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return d(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)o(a,this,t);else{var u=a.length,d=E(a,u);for(n=0;n<u;++n)o(d[n],this,t)}return!0},c.prototype.addListener=function(e,t){return l(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return l(this,e,t,!0)},c.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},c.prototype.listeners=function(e){return p(this,e,!0)},c.prototype.rawListeners=function(e){return p(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},c.prototype.listenerCount=g,c.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(79),t),i(n(115),t)},function(e,t,n){"use strict";n.r(t),n.d(t,"generateKeyPair",(function(){return o})),n.d(t,"generateRandomBytes32",(function(){return s})),n.d(t,"deriveSharedKey",(function(){return c})),n.d(t,"sha256",(function(){return a})),n.d(t,"encrypt",(function(){return u})),n.d(t,"decrypt",(function(){return d})),n.d(t,"ERROR_TYPE",(function(){return f})),n.d(t,"ERROR",(function(){return _})),n.d(t,"REACT_NATIVE_PRODUCT",(function(){return l.f})),n.d(t,"ENV_MAP",(function(){return l.d})),n.d(t,"EMPTY_SPACE",(function(){return l.c})),n.d(t,"COLON",(function(){return l.a})),n.d(t,"SLASH",(function(){return l.g})),n.d(t,"DEFAULT_DEPTH",(function(){return l.b})),n.d(t,"ONE_THOUSAND",(function(){return l.e})),n.d(t,"isNode",(function(){return l.x})),n.d(t,"isReactNative",(function(){return l.y})),n.d(t,"isBrowser",(function(){return l.w})),n.d(t,"getEnvironment",(function(){return l.s})),n.d(t,"appendToQueryString",(function(){return l.h})),n.d(t,"getAppMetadata",(function(){return l.r})),n.d(t,"getRelayClientMetadata",(function(){return l.u})),n.d(t,"formatRelayRpcUrl",(function(){return l.o})),n.d(t,"assertType",(function(){return l.i})),n.d(t,"parseContextNames",(function(){return l.D})),n.d(t,"formatMessageContext",(function(){return l.n})),n.d(t,"formatStorageKeyName",(function(){return l.p})),n.d(t,"hasOverlap",(function(){return l.v})),n.d(t,"getLastItems",(function(){return l.t})),n.d(t,"mergeArrays",(function(){return l.B})),n.d(t,"mapToObj",(function(){return l.A})),n.d(t,"objToMap",(function(){return l.C})),n.d(t,"mapEntries",(function(){return l.z})),n.d(t,"enumify",(function(){return l.m})),n.d(t,"capitalizeWord",(function(){return l.l})),n.d(t,"capitalize",(function(){return l.k})),n.d(t,"toMiliseconds",(function(){return l.E})),n.d(t,"fromMiliseconds",(function(){return l.q})),n.d(t,"calcExpiry",(function(){return l.j})),n.d(t,"RELAYER_DEFAULT_PROTOCOL",(function(){return R})),n.d(t,"getRelayProtocolName",(function(){return m})),n.d(t,"getRelayProtocolApi",(function(){return S})),n.d(t,"formatUri",(function(){return N})),n.d(t,"parseUri",(function(){return b})),n.d(t,"isSignalTypePairing",(function(){return I})),n.d(t,"isSignalTypeUri",(function(){return w})),n.d(t,"isSequenceRespondedStatus",(function(){return A})),n.d(t,"isSequenceResponded",(function(){return P})),n.d(t,"isSequenceRejected",(function(){return C})),n.d(t,"isSequenceFailed",(function(){return U})),n.d(t,"isPairingRespondedStatus",(function(){return L})),n.d(t,"isPairingResponded",(function(){return D})),n.d(t,"isPairingRejected",(function(){return x})),n.d(t,"isPairingFailed",(function(){return M})),n.d(t,"isSessionRespondedStatus",(function(){return q})),n.d(t,"isSessionResponded",(function(){return j})),n.d(t,"isSessionRejected",(function(){return H})),n.d(t,"isSessionFailed",(function(){return V})),n.d(t,"isStoreUpdatedEvent",(function(){return K})),n.d(t,"validateSessionProposeParamsPermissions",(function(){return G})),n.d(t,"validateSessionProposeParamsMetadata",(function(){return B})),n.d(t,"validateSessionProposeParams",(function(){return k})),n.d(t,"validateSessionRespondParams",(function(){return Y})),n.d(t,"validateBlockchainPermissions",(function(){return J})),n.d(t,"validateJsonRpcPermissions",(function(){return F})),n.d(t,"validateNotificationPermissions",(function(){return z})),n.d(t,"validateBlockchainState",(function(){return X})),n.d(t,"isValidArray",(function(){return W})),n.d(t,"isValidString",(function(){return Q})),n.d(t,"isValidChainId",(function(){return $})),n.d(t,"isValidAccountId",(function(){return Z})),n.d(t,"isValidUrl",(function(){return ee})),n.d(t,"isValidationInvalid",(function(){return te})),n.d(t,"formatValidResult",(function(){return ne})),n.d(t,"formatInvalidResult",(function(){return re}));var r=n(21),i=n(1);function o(){const e=r.generateKeyPair();return{privateKey:i.arrayToHex(e.privateKey),publicKey:i.arrayToHex(e.publicKey)}}function s(){return i.arrayToHex(r.randomBytes(32))}function c(e,t){const n=r.derive(i.hexToArray(e),i.hexToArray(t));return i.arrayToHex(n)}async function a(e){const t=await r.sha256(i.hexToArray(e));return i.arrayToHex(t)}async function u(e){const t=i.utf8ToArray(e.message),n=i.hexToArray(e.sharedKey),o=i.hexToArray(e.publicKey),s=void 0!==e.iv?i.hexToArray(e.iv):void 0,c=await r.encryptWithSharedKey(t,n,o,s);return i.arrayToHex(c)}async function d(e){const t=i.hexToArray(e.encrypted),n=i.hexToArray(e.sharedKey),o=await r.decryptWithSharedKey(t,n);return i.arrayToUtf8(o)}var l=n(13);const f=Object(l.m)({GENERIC:"GENERIC",MISSING_OR_INVALID:"MISSING_OR_INVALID",MISSING_RESPONSE:"MISSING_RESPONSE",MISSING_DECRYPT_PARAMS:"MISSING_DECRYPT_PARAMS",INVALID_UPDATE_REQUEST:"INVALID_UPDATE_REQUEST",INVALID_UPGRADE_REQUEST:"INVALID_UPGRADE_REQUEST",INVALID_EXTEND_REQUEST:"INVALID_EXTEND_REQUEST",INVALID_STORAGE_KEY_NAME:"INVALID_STORAGE_KEY_NAME",RECORD_ALREADY_EXISTS:"RECORD_ALREADY_EXISTS",RESTORE_WILL_OVERRIDE:"RESTORE_WILL_OVERRIDE",NO_MATCHING_ID:"NO_MATCHING_ID",NO_MATCHING_TOPIC:"NO_MATCHING_TOPIC",NO_MATCHING_RESPONSE:"NO_MATCHING_RESPONSE",NO_MATCHING_KEY:"NO_MATCHING_KEY",UNKNOWN_JSONRPC_METHOD:"UNKNOWN_JSONRPC_METHOD",MISMATCHED_TOPIC:"MISMATCHED_TOPIC",MISMATCHED_ACCOUNTS:"MISMATCHED_ACCOUNTS",SETTLED:"SETTLED",NOT_APPROVED:"NOT_APPROVED",PROPOSAL_RESPONDED:"PROPOSAL_RESPONDED",RESPONSE_ACKNOWLEDGED:"RESPONSE_ACKNOWLEDGED",EXPIRED:"EXPIRED",DELETED:"DELETED",RESUBSCRIBED:"RESUBSCRIBED",SETTLE_TIMEOUT:"SETTLE_TIMEOUT",JSONRPC_REQUEST_TIMEOUT:"JSONRPC_REQUEST_TIMEOUT",UNAUTHORIZED_TARGET_CHAIN:"UNAUTHORIZED_TARGET_CHAIN",UNAUTHORIZED_JSON_RPC_METHOD:"UNAUTHORIZED_JSON_RPC_METHOD",UNAUTHORIZED_NOTIFICATION_TYPE:"UNAUTHORIZED_NOTIFICATION_TYPE",UNAUTHORIZED_UPDATE_REQUEST:"UNAUTHORIZED_UPDATE_REQUEST",UNAUTHORIZED_UPGRADE_REQUEST:"UNAUTHORIZED_UPGRADE_REQUEST",UNAUTHORIZED_EXTEND_REQUEST:"UNAUTHORIZED_EXTEND_REQUEST",UNAUTHORIZED_MATCHING_CONTROLLER:"UNAUTHORIZED_MATCHING_CONTROLLER",JSONRPC_REQUEST_METHOD_REJECTED:"JSONRPC_REQUEST_METHOD_REJECTED",JSONRPC_REQUEST_METHOD_UNAUTHORIZED:"JSONRPC_REQUEST_METHOD_UNAUTHORIZED",JSONRPC_REQUEST_METHOD_UNSUPPORTED:"JSONRPC_REQUEST_METHOD_UNSUPPORTED",DISCONNECTED_ALL_CHAINS:"DISCONNECTED_ALL_CHAINS",DISCONNECTED_TARGET_CHAIN:"DISCONNECTED_TARGET_CHAIN",DISAPPROVED_CHAINS:"DISAPPROVED_CHAINS",DISAPPROVED_JSONRPC:"DISAPPROVED_JSONRPC",DISAPPROVED_NOTIFICATION:"DISAPPROVED_NOTIFICATION",UNSUPPORTED_CHAINS:"UNSUPPORTED_CHAINS",UNSUPPORTED_JSONRPC:"UNSUPPORTED_JSONRPC",UNSUPPORTED_NOTIFICATION:"UNSUPPORTED_NOTIFICATION",UNSUPPORTED_SIGNAL:"UNSUPPORTED_SIGNAL",USER_DISCONNECTED:"USER_DISCONNECTED",UNKNOWN:"UNKNOWN"}),h="undefined",p="Something went wrong",g="parameter",E="session",y="Ethereum",_={[f.GENERIC]:{type:f.GENERIC,code:0,stringify:e=>(null==e?void 0:e.message)||p,format:e=>({code:_[f.GENERIC].code,message:_[f.GENERIC].stringify(e)})},[f.MISSING_OR_INVALID]:{type:f.MISSING_OR_INVALID,code:1e3,stringify:e=>"Missing or invalid "+((null==e?void 0:e.name)||g),format:e=>({code:_[f.MISSING_OR_INVALID].code,message:_[f.MISSING_OR_INVALID].stringify(e)})},[f.MISSING_RESPONSE]:{type:f.MISSING_RESPONSE,code:1001,stringify:e=>`Response is required for approved ${(null==e?void 0:e.context)||E} proposals`,format:e=>({code:_[f.MISSING_RESPONSE].code,message:_[f.MISSING_RESPONSE].stringify(e)})},[f.MISSING_DECRYPT_PARAMS]:{type:f.MISSING_DECRYPT_PARAMS,code:1002,stringify:e=>"Decrypt params required for "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.MISSING_DECRYPT_PARAMS].code,message:_[f.MISSING_DECRYPT_PARAMS].stringify(e)})},[f.INVALID_UPDATE_REQUEST]:{type:f.INVALID_UPDATE_REQUEST,code:1003,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} update request`,format:e=>({code:_[f.INVALID_UPDATE_REQUEST].code,message:_[f.INVALID_UPDATE_REQUEST].stringify(e)})},[f.INVALID_UPGRADE_REQUEST]:{type:f.INVALID_UPGRADE_REQUEST,code:1004,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} upgrade request`,format:e=>({code:_[f.INVALID_UPGRADE_REQUEST].code,message:_[f.INVALID_UPGRADE_REQUEST].stringify(e)})},[f.INVALID_EXTEND_REQUEST]:{type:f.INVALID_EXTEND_REQUEST,code:1005,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} extend request`,format:e=>({code:_[f.INVALID_EXTEND_REQUEST].code,message:_[f.INVALID_EXTEND_REQUEST].stringify(e)})},[f.INVALID_STORAGE_KEY_NAME]:{type:f.INVALID_STORAGE_KEY_NAME,code:1020,stringify:e=>"Invalid storage key name: "+((null==e?void 0:e.name)||g),format:e=>({code:_[f.INVALID_STORAGE_KEY_NAME].code,message:_[f.INVALID_STORAGE_KEY_NAME].stringify(e)})},[f.RECORD_ALREADY_EXISTS]:{type:f.RECORD_ALREADY_EXISTS,code:1100,stringify:e=>`Record already exists for ${(null==e?void 0:e.context)||E} matching id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.RECORD_ALREADY_EXISTS].code,message:_[f.RECORD_ALREADY_EXISTS].stringify(e)})},[f.RESTORE_WILL_OVERRIDE]:{type:f.RESTORE_WILL_OVERRIDE,code:1200,stringify:e=>"Restore will override already set "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.RESTORE_WILL_OVERRIDE].code,message:_[f.RESTORE_WILL_OVERRIDE].stringify(e)})},[f.NO_MATCHING_ID]:{type:f.NO_MATCHING_ID,code:1300,stringify:e=>`No matching ${(null==e?void 0:e.context)||E} with id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.NO_MATCHING_ID].code,message:_[f.NO_MATCHING_ID].stringify(e)})},[f.NO_MATCHING_TOPIC]:{type:f.NO_MATCHING_TOPIC,code:1301,stringify:e=>`No matching ${(null==e?void 0:e.context)||E} with topic: ${null==e?void 0:e.topic}`,format:e=>({code:_[f.NO_MATCHING_TOPIC].code,message:_[f.NO_MATCHING_TOPIC].stringify(e)})},[f.NO_MATCHING_RESPONSE]:{type:f.NO_MATCHING_RESPONSE,code:1302,stringify:e=>`No response found in pending ${(null==e?void 0:e.context)||E} proposal`,format:e=>({code:_[f.NO_MATCHING_RESPONSE].code,message:_[f.NO_MATCHING_RESPONSE].stringify(e)})},[f.NO_MATCHING_KEY]:{type:f.NO_MATCHING_KEY,code:1303,stringify:e=>"No matching key with tag: "+(null==e?void 0:e.tag),format:e=>({code:_[f.NO_MATCHING_KEY].code,message:_[f.NO_MATCHING_KEY].stringify(e)})},[f.UNKNOWN_JSONRPC_METHOD]:{type:f.UNKNOWN_JSONRPC_METHOD,code:1400,stringify:e=>"Unknown JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:_[f.UNKNOWN_JSONRPC_METHOD].code,message:_[f.UNKNOWN_JSONRPC_METHOD].stringify(e)})},[f.MISMATCHED_TOPIC]:{type:f.MISMATCHED_TOPIC,code:1500,stringify:e=>`Mismatched topic for ${(null==e?void 0:e.context)||E} with id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.MISMATCHED_TOPIC].code,message:_[f.MISMATCHED_TOPIC].stringify(e)})},[f.MISMATCHED_ACCOUNTS]:{type:f.MISMATCHED_ACCOUNTS,code:1501,stringify:e=>"Invalid accounts with mismatched chains: "+(null==e?void 0:e.mismatched.toString()),format:e=>({code:_[f.MISMATCHED_ACCOUNTS].code,message:_[f.MISMATCHED_ACCOUNTS].stringify(e)})},[f.SETTLED]:{type:f.SETTLED,code:1600,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" settled",format:e=>({code:_[f.SETTLED].code,message:_[f.SETTLED].stringify(e)})},[f.NOT_APPROVED]:{type:f.NOT_APPROVED,code:1601,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" not approved",format:e=>({code:_[f.NOT_APPROVED].code,message:_[f.NOT_APPROVED].stringify(e)})},[f.PROPOSAL_RESPONDED]:{type:f.PROPOSAL_RESPONDED,code:1602,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" proposal responded",format:e=>({code:_[f.PROPOSAL_RESPONDED].code,message:_[f.PROPOSAL_RESPONDED].stringify(e)})},[f.RESPONSE_ACKNOWLEDGED]:{type:f.RESPONSE_ACKNOWLEDGED,code:1603,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" response acknowledge",format:e=>({code:_[f.RESPONSE_ACKNOWLEDGED].code,message:_[f.RESPONSE_ACKNOWLEDGED].stringify(e)})},[f.EXPIRED]:{type:f.EXPIRED,code:1604,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" expired",format:e=>({code:_[f.EXPIRED].code,message:_[f.EXPIRED].stringify(e)})},[f.DELETED]:{type:f.DELETED,code:1605,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" deleted",format:e=>({code:_[f.DELETED].code,message:_[f.DELETED].stringify(e)})},[f.RESUBSCRIBED]:{type:f.RESUBSCRIBED,code:1606,stringify:e=>"Subscription resubscribed with topic: "+(e.topic||h),format:e=>({code:_[f.RESUBSCRIBED].code,message:_[f.RESUBSCRIBED].stringify(e)})},[f.SETTLE_TIMEOUT]:{type:f.SETTLE_TIMEOUT,code:2e3,stringify:e=>`${Object(l.k)((null==e?void 0:e.context)||E)} failed to settle after ${Object(l.q)(null==e?void 0:e.timeout)} seconds`,format:e=>({code:_[f.SETTLE_TIMEOUT].code,message:_[f.SETTLE_TIMEOUT].stringify(e)})},[f.JSONRPC_REQUEST_TIMEOUT]:{type:f.JSONRPC_REQUEST_TIMEOUT,code:2001,stringify:e=>`JSON-RPC Request timeout after ${Object(l.q)(null==e?void 0:e.timeout)} seconds: ${null==e?void 0:e.method}`,format:e=>({code:_[f.JSONRPC_REQUEST_TIMEOUT].code,message:_[f.JSONRPC_REQUEST_TIMEOUT].stringify(e)})},[f.UNAUTHORIZED_TARGET_CHAIN]:{type:f.UNAUTHORIZED_TARGET_CHAIN,code:3e3,stringify:e=>"Unauthorized Target ChainId Requested: "+(null==e?void 0:e.chainId),format:e=>({code:_[f.UNAUTHORIZED_TARGET_CHAIN].code,message:_[f.UNAUTHORIZED_TARGET_CHAIN].stringify(e)})},[f.UNAUTHORIZED_JSON_RPC_METHOD]:{type:f.UNAUTHORIZED_JSON_RPC_METHOD,code:3001,stringify:e=>"Unauthorized JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:_[f.UNAUTHORIZED_JSON_RPC_METHOD].code,message:_[f.UNAUTHORIZED_JSON_RPC_METHOD].stringify(e)})},[f.UNAUTHORIZED_NOTIFICATION_TYPE]:{type:f.UNAUTHORIZED_NOTIFICATION_TYPE,code:3002,stringify:e=>"Unauthorized Notification Type Requested: "+(null==e?void 0:e.type),format:e=>({code:_[f.UNAUTHORIZED_NOTIFICATION_TYPE].code,message:_[f.UNAUTHORIZED_NOTIFICATION_TYPE].stringify(e)})},[f.UNAUTHORIZED_UPDATE_REQUEST]:{type:f.UNAUTHORIZED_UPDATE_REQUEST,code:3003,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} update request`,format:e=>({code:_[f.UNAUTHORIZED_UPDATE_REQUEST].code,message:_[f.UNAUTHORIZED_UPDATE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_UPGRADE_REQUEST]:{type:f.UNAUTHORIZED_UPGRADE_REQUEST,code:3004,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} upgrade request`,format:e=>({code:_[f.UNAUTHORIZED_UPGRADE_REQUEST].code,message:_[f.UNAUTHORIZED_UPGRADE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_EXTEND_REQUEST]:{type:f.UNAUTHORIZED_EXTEND_REQUEST,code:3005,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} extend request`,format:e=>({code:_[f.UNAUTHORIZED_EXTEND_REQUEST].code,message:_[f.UNAUTHORIZED_EXTEND_REQUEST].stringify(e)})},[f.UNAUTHORIZED_MATCHING_CONTROLLER]:{type:f.UNAUTHORIZED_MATCHING_CONTROLLER,code:3100,stringify:e=>`Unauthorized: peer is also ${(null==e?void 0:e.controller)?"":"not "}controller`,format:e=>({code:_[f.UNAUTHORIZED_MATCHING_CONTROLLER].code,message:_[f.UNAUTHORIZED_MATCHING_CONTROLLER].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_REJECTED]:{type:f.JSONRPC_REQUEST_METHOD_REJECTED,code:4001,stringify:e=>"User rejected the request.",format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_REJECTED].code,message:_[f.JSONRPC_REQUEST_METHOD_REJECTED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED]:{type:f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED,code:4100,stringify:e=>"The requested account and/or method has not been authorized by the user.",format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].code,message:_[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED]:{type:f.JSONRPC_REQUEST_METHOD_UNSUPPORTED,code:4200,stringify:e=>`The requested method is not supported by this ${(null==e?void 0:e.blockhain)||y} provider.`,format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].code,message:_[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].stringify(e)})},[f.DISCONNECTED_ALL_CHAINS]:{type:f.DISCONNECTED_ALL_CHAINS,code:4900,stringify:e=>"The provider is disconnected from all chains.",format:e=>({code:_[f.DISCONNECTED_ALL_CHAINS].code,message:_[f.DISCONNECTED_ALL_CHAINS].stringify(e)})},[f.DISCONNECTED_TARGET_CHAIN]:{type:f.DISCONNECTED_TARGET_CHAIN,code:4901,stringify:e=>"The provider is disconnected from the specified chain.",format:e=>({code:_[f.DISCONNECTED_TARGET_CHAIN].code,message:_[f.DISCONNECTED_TARGET_CHAIN].stringify(e)})},[f.DISAPPROVED_CHAINS]:{type:f.DISAPPROVED_CHAINS,code:5e3,stringify:e=>"User disapproved requested chains",format:e=>({code:_[f.DISAPPROVED_CHAINS].code,message:_[f.DISAPPROVED_CHAINS].stringify(e)})},[f.DISAPPROVED_JSONRPC]:{type:f.DISAPPROVED_JSONRPC,code:5001,stringify:e=>"User disapproved requested json-rpc methods",format:e=>({code:_[f.DISAPPROVED_JSONRPC].code,message:_[f.DISAPPROVED_JSONRPC].stringify(e)})},[f.DISAPPROVED_NOTIFICATION]:{type:f.DISAPPROVED_NOTIFICATION,code:5002,stringify:e=>"User disapproved requested notification types",format:e=>({code:_[f.DISAPPROVED_NOTIFICATION].code,message:_[f.DISAPPROVED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_CHAINS]:{type:f.UNSUPPORTED_CHAINS,code:5100,stringify:e=>"Requested chains are not supported: "+(null==e?void 0:e.chains.toString()),format:e=>({code:_[f.UNSUPPORTED_CHAINS].code,message:_[f.UNSUPPORTED_CHAINS].stringify(e)})},[f.UNSUPPORTED_JSONRPC]:{type:f.UNSUPPORTED_JSONRPC,code:5101,stringify:e=>"Requested json-rpc methods are not supported: "+(null==e?void 0:e.methods.toString()),format:e=>({code:_[f.UNSUPPORTED_JSONRPC].code,message:_[f.UNSUPPORTED_JSONRPC].stringify(e)})},[f.UNSUPPORTED_NOTIFICATION]:{type:f.UNSUPPORTED_NOTIFICATION,code:5102,stringify:e=>"Requested notification types are not supported: "+(null==e?void 0:e.types.toString()),format:e=>({code:_[f.UNSUPPORTED_NOTIFICATION].code,message:_[f.UNSUPPORTED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_SIGNAL]:{type:f.UNSUPPORTED_SIGNAL,code:5103,stringify:e=>`Proposed ${(null==e?void 0:e.context)||E} signal is unsupported`,format:e=>({code:_[f.UNSUPPORTED_SIGNAL].code,message:_[f.UNSUPPORTED_SIGNAL].stringify(e)})},[f.USER_DISCONNECTED]:{type:f.USER_DISCONNECTED,code:5900,stringify:e=>"User disconnected "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.USER_DISCONNECTED].code,message:_[f.USER_DISCONNECTED].stringify(e)})},[f.UNKNOWN]:{type:f.UNKNOWN,code:9e3,stringify:e=>"Unknown error"+(e?": "+(null==e?void 0:e.toString()):""),format:e=>({code:_[f.UNKNOWN].code,message:_[f.UNKNOWN].stringify(e)})}};var v=n(90);const R="waku";function m(e){return(null==e?void 0:e.relay)||{protocol:R}}function S(e){const t=v.RELAY_JSONRPC[e];if(void 0===t)throw new Error("Relay Protocol not supported: "+e);return t}var T=n(23),O=n(19);function N(e){return`${e.protocol}:${e.topic}@${e.version}?`+T.stringify({publicKey:e.publicKey,controller:e.controller,relay:Object(O.safeJsonStringify)(e.relay)})}function b(e){const t=e.indexOf(":"),n=-1!==e.indexOf("?")?e.indexOf("?"):void 0,r=e.substring(0,t),i=e.substring(t+1,n).split("@"),o=void 0!==n?e.substr(n):"",s=T.parse(o);return{protocol:r,topic:i[0],version:parseInt(i[1],10),publicKey:s.publicKey,controller:"true"===s.controller,relay:Object(O.safeJsonParse)(s.relay)}}function I(e){return"pairing"===e.method}function w(e){return"uri"===e.method}function A(e){return"responded"===e}function P(e){return A(e.status)&&"outcome"in e}function C(e){return"reason"in e}function U(e){return"reason"in e}function L(e){return"responded"===e}function D(e){return L(e.status)&&"outcome"in e}function x(e){return"reason"in e}function M(e){return"reason"in e}function q(e){return"responded"===e}function j(e){return L(e.status)&&"outcome"in e}function H(e){return"reason"in e}function V(e){return"reason"in e}function K(e){return"update"in e}function G(e){const t=J(e.blockchain);if(te(t))return t;const n=F(e.jsonrpc);if(te(n))return n;const r=z(e.notifications);return te(r)?r:{valid:!0}}function B(e){return Q(e.name)?Q(e.description)?void 0!==e.url&&ee(e.url)?void 0!==e.icons&&W(e.icons,ee)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"metadata icons"})):re(_.MISSING_OR_INVALID.format({name:"metadata url"})):re(_.MISSING_OR_INVALID.format({name:"metadata description"})):re(_.MISSING_OR_INVALID.format({name:"metadata name"}))}function k(e){const t=G(e.permissions);if(te(t))return t;const n=B(e.metadata);return te(n)?n:{valid:!0}}function Y(e){if(e.approved){if(void 0===e.response)return re(_.MISSING_RESPONSE.format({context:"session"}));const t=X(e.response.state,e.proposal.permissions.blockchain);if(te(t))return t;const n=B(e.response.metadata);if(te(n))return n}return{valid:!0}}function J(e){return void 0!==e&&void 0!==e.chains&&W(e.chains,$)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"blockchain permissions"}))}function F(e){return void 0!==e&&void 0!==e.methods&&W(e.methods,Q)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"jsonrpc permissions"}))}function z(e){return void 0!==e&&void 0!==e.types&&W(e.types,Q)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"notification permissions"}))}function X(e,t){if(void 0===t||void 0===t.chains||!W(t.chains,$))return re(_.MISSING_OR_INVALID.format({name:"blockchain permissions"}));if(void 0===e||void 0===e.accounts||!W(e.accounts,Z))return re(_.MISSING_OR_INVALID.format({name:"state accounts"}));const n=e.accounts.filter(e=>{const[n,r]=e.split(":"),i=`${n}:${r}`;return!t.chains.includes(i)});return n.length?re(_.MISMATCHED_ACCOUNTS.format({mismatched:n})):{valid:!0}}function W(e,t){if(Array.isArray(e)){if(void 0!==t&&e.length){return e.filter(t).length===e.length}return!0}return!1}function Q(e){return"string"==typeof e&&!!e.trim()}function $(e){if(Q(e)&&e.includes(":")){return 2===e.split(":").length}return!1}function Z(e){if(Q(e)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&$(e)}}return!1}function ee(e){if(Q(e))try{return void 0!==new URL(e)}catch(e){return!1}return!1}function te(e){return"valid"in e&&!1===e.valid&&"error"in e&&"number"==typeof e.error.code&&"string"==typeof e.error.message}function ne(){return{valid:!0}}function re(e){return{valid:!1,error:e}}},function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return a})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return h})),n.d(t,"e",(function(){return p})),n.d(t,"x",(function(){return g})),n.d(t,"y",(function(){return E})),n.d(t,"w",(function(){return y})),n.d(t,"s",(function(){return _})),n.d(t,"h",(function(){return v})),n.d(t,"r",(function(){return R})),n.d(t,"u",(function(){return m})),n.d(t,"o",(function(){return S})),n.d(t,"i",(function(){return T})),n.d(t,"D",(function(){return O})),n.d(t,"n",(function(){return N})),n.d(t,"p",(function(){return b})),n.d(t,"v",(function(){return I})),n.d(t,"t",(function(){return w})),n.d(t,"B",(function(){return A})),n.d(t,"A",(function(){return P})),n.d(t,"C",(function(){return C})),n.d(t,"z",(function(){return U})),n.d(t,"m",(function(){return L})),n.d(t,"l",(function(){return D})),n.d(t,"k",(function(){return x})),n.d(t,"E",(function(){return M})),n.d(t,"q",(function(){return q})),n.d(t,"j",(function(){return j}));var r=n(88),i=n.n(r),o=n(23),s=n(89),c=n(24);const a="ReactNative",u={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},d=" ",l=":",f="/",h=2,p=1e3;function g(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}function E(){return!Object(c.getDocument)()&&!!Object(c.getNavigator)()&&navigator.product===a}function y(){return!g()&&!!Object(c.getNavigator)()}function _(){return E()?u.reactNative:g()?u.node:y()?u.browser:u.unknown}function v(e,t){let n=o.parse(e);return n=Object.assign(Object.assign({},n),t),e=o.stringify(n)}function R(){return Object(s.getWindowMetadata)()||void 0}function m(e,t){var n;const r=_(),i={protocol:e,version:t,env:r};return"browser"===r&&(i.host=(null===(n=Object(c.getLocation)())||void 0===n?void 0:n.host)||""),i}function S(e,t,n,r){const i=n.split("?"),o=m(e,t),s=r?Object.assign(Object.assign({},o),{projectId:r}):o,c=v(i[1]||"",s);return i[0]+"?"+c}function T(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function O(e,t=h){return w(e.split(f),t)}function N(e){return O(e).join(d)}function b(e){return O(e).join(l)}function I(e,t){return e.filter(e=>t.includes(e)).length===e.length}function w(e,t=h){return e.slice(Math.max(e.length-t,0))}function A(e,t){return i()(e,t)}function P(e){return Object.fromEntries(e.entries())}function C(e){return new Map(Object.entries(e))}function U(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const L=e=>e;function D(e){return e.trim().replace(/^\w/,e=>e.toUpperCase())}function x(e){return e.split(d).map(e=>D(e)).join(d)}function M(e){return e*p}function q(e){return Math.floor(e/p)}function j(e,t){return q((t||Date.now())+M(e))}}).call(this,n(60))},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return l}));var r=n(6),i=n(0);async function o(e,t=i.a){return r.getSubtleCrypto().importKey("raw",e,function(e){return e===i.a?{length:i.b,name:i.a}:{hash:{name:i.g},name:i.f}}(t),!0,function(e){return e===i.a?[i.d,i.c]:[i.p,i.q]}(t))}async function s(e,t,n){const s=r.getSubtleCrypto(),c=await o(t,i.a),a=await s.encrypt({iv:e,name:i.a},c,n);return new Uint8Array(a)}async function c(e,t,n){const s=r.getSubtleCrypto(),c=await o(t,i.a),a=await s.decrypt({iv:e,name:i.a},c,n);return new Uint8Array(a)}async function a(e,t){const n=r.getSubtleCrypto(),s=await o(e,i.f),c=await n.sign({length:i.h,name:i.f},s,t);return new Uint8Array(c)}async function u(e,t){const n=r.getSubtleCrypto(),s=await o(e,i.f),c=await n.sign({length:i.l,name:i.f},s,t);return new Uint8Array(c)}async function d(e){const t=r.getSubtleCrypto(),n=await t.digest({name:i.n},e);return new Uint8Array(n)}async function l(e){const t=r.getSubtleCrypto(),n=await t.digest({name:i.o},e);return new Uint8Array(n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"h",(function(){return f})),n.d(t,"b",(function(){return h}));var r=n(37),i=n(1),o=n(3);function s(e,t){return r.sharedKey(e,t)}function c(e){const t=void 0!==e?function(e){return{isAvailable:!0,randomBytes:()=>e}}(e):void 0,n=r.generateKeyPair(t);return{publicKey:n.publicKey,privateKey:n.secretKey}}function a(e){const t=(null==e?void 0:e.sender)||c();return{privateKey:t.privateKey,publicKey:t.publicKey}}function u(e,t){return s(e,t)}function d(e){return new Uint8Array(e.slice(o.LENGTH_0,o.KEY_LENGTH))}function l(e){return new Uint8Array(e.slice(o.KEY_LENGTH))}function f(e){return Object(i.concatArrays)(e.iv,e.publicKey,e.mac,e.ciphertext)}function h(e){const t=o.LENGTH_0,n=t+o.IV_LENGTH,r=n+o.KEY_LENGTH,i=r+o.MAC_LENGTH,s=e.length;return{iv:e.slice(t,n),publicKey:e.slice(n,r),mac:e.slice(r,i),ciphertext:e.slice(i,s)}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return a})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return l}));var r=n(7);function i(e){return Object(r.c)(e,"subscribe")}function o(e){return Object(r.b)(e,["topic"],[])}function s(e){return Object(r.c)(e,"publish")}function c(e){return Object(r.b)(e,["message","topic","ttl"],["prompt"])}function a(e){return Object(r.c)(e,"unsubscribe")}function u(e){return Object(r.b)(e,["id","topic"],[])}function d(e){return Object(r.c)(e,"subscription")}function l(e){return Object(r.b)(e,["id","data"],[])}},function(e,t,n){"use strict";n.r(t);var r=n(40);n.d(t,"IClient",(function(){return r.a}));var i=n(44);n.d(t,"IKeyChain",(function(){return i.b})),n.d(t,"ICrypto",(function(){return i.a}));var o=n(45);n.d(t,"IEncoder",(function(){return o.a}));var s=n(46);n.d(t,"IEngine",(function(){return s.a}));var c=n(47);n.d(t,"IExpirer",(function(){return c.a}));var a=n(48);n.d(t,"IHeartBeat",(function(){return a.a}));var u=n(49);n.d(t,"IJsonRpcHistory",(function(){return u.a}));var d=n(50);for(var l in d)["default","IClient","IKeyChain","ICrypto","IEncoder","IEngine","IExpirer","IHeartBeat","IJsonRpcHistory"].indexOf(l)<0&&function(e){n.d(t,e,(function(){return d[e]}))}(l);var f=n(51);for(var l in f)["default","IClient","IKeyChain","ICrypto","IEncoder","IEngine","IExpirer","IHeartBeat","IJsonRpcHistory"].indexOf(l)<0&&function(e){n.d(t,e,(function(){return f[e]}))}(l);var h=n(52);n.d(t,"IPairing",(function(){return h.a}));var p=n(53);n.d(t,"IPublisher",(function(){return p.a}));var g=n(54);n.d(t,"IRelayerEncoder",(function(){return g.b})),n.d(t,"IRelayer",(function(){return g.a}));var E=n(22);n.d(t,"ISequence",(function(){return E.a}));var y=n(55);n.d(t,"ISession",(function(){return y.a}));var _=n(56);n.d(t,"IStore",(function(){return _.a}));var v=n(57);n.d(t,"IBaseStorage",(function(){return v.a})),n.d(t,"IRelayerStorage",(function(){return v.b})),n.d(t,"IStorage",(function(){return v.c}));var R=n(58);n.d(t,"ISubscriberTopicMap",(function(){return R.b})),n.d(t,"ISubscriber",(function(){return R.a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_SECOND=t.FIVE_SECONDS=t.TEN_SECONDS=t.THIRTY_SECONDS=t.FIVE_MINUTES=t.SIX_HOURS=t.ONE_DAY=t.SEVEN_DAYS=t.THREE_WEEKS=t.THIRTY_DAYS=void 0,t.THIRTY_DAYS=2592e3,t.THREE_WEEKS=1814400,t.SEVEN_DAYS=604800,t.ONE_DAY=86400,t.SIX_HOURS=21600,t.FIVE_MINUTES=300,t.THIRTY_SECONDS=30,t.TEN_SECONDS=10,t.FIVE_SECONDS=5,t.ONE_SECOND=1},function(e,t,n){"use strict";function r(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}}function i(e){return"string"==typeof e?e:JSON.stringify(e)}n.r(t),n.d(t,"safeJsonParse",(function(){return r})),n.d(t,"safeJsonStringify",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return a})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return d}));var r=n(4);function i(e){return e<=r.h[0]&&e>=r.h[1]}function o(e){return r.f.includes(e)}function s(e){return"number"==typeof e}function c(e){return Object.keys(r.i).includes(e)?r.i[e]:r.i[r.a]}function a(e){const t=Object.values(r.i).find(t=>t.code===e);return t||r.i[r.a]}function u(e){if(void 0===e.error.code)return{valid:!1,error:"Missing code for JSON-RPC error"};if(void 0===e.error.message)return{valid:!1,error:"Missing message for JSON-RPC error"};if(!s(e.error.code))return{valid:!1,error:"Invalid error code type for JSON-RPC: "+e.error.code};if(o(e.error.code)){const t=a(e.error.code);if(t.message!==r.i[r.a].message&&e.error.message===t.message)return{valid:!1,error:"Invalid error code message for JSON-RPC: "+e.error.code}}return{valid:!0}}function d(e,t,n){return null!=e&&null!=e.message&&(e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED"))?new Error(`Unavailable ${n} RPC url at ${t}`):e}},function(e,t,n){"use strict";var r=n(3);n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"randomBytes")&&n.d(t,"randomBytes",(function(){return r.randomBytes})),n.o(r,"sha256")&&n.d(t,"sha256",(function(){return r.sha256}));var i=n(68);n.d(t,"decryptWithSharedKey",(function(){return i.a})),n.d(t,"encryptWithSharedKey",(function(){return i.b}));var o=n(15);n.d(t,"derive",(function(){return o.a})),n.d(t,"generateKeyPair",(function(){return o.c}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,n){"use strict";const r=n(111),i=n(112),o=n(113),s=n(114);function c(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function a(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function l(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function f(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){c((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const i="string"==typeof n&&n.includes(e.arrayFormatSeparator),o="string"==typeof n&&!i&&u(n,e).includes(e.arrayFormatSeparator);n=o?u(n,e):n;const s=i||o?n.split(e.arrayFormatSeparator).map(t=>u(t,e)):null===n?n:u(n,e);r[t]=s};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const i of e.split("&")){if(""===i)continue;let[e,s]=o(t.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator"].includes(t.arrayFormat)?s:u(s,t),n(u(e,t),s,r)}for(const e of Object.keys(r)){const n=r[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=f(n[e],t);else r[e]=f(n,t)}return!1===t.sort?r:(!0===t.sort?Object.keys(r).sort():Object.keys(r).sort(t.sort)).reduce((e,t)=>{const n=r[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}t.extract=l,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";c((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],r=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const i=n.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[a(t,e),"[",i,"]"].join("")]:[...n,[a(t,e),"[",a(i,e),"]=",a(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[a(t,e),"[]"].join("")]:[...n,[a(t,e),"[]=",a(r,e)].join("")];case"comma":case"separator":return t=>(n,r)=>null==r||0===r.length?n:0===n.length?[[a(t,e),"=",a(r,e)].join("")]:[[n,a(r,e)].join(e.arrayFormatSeparator)];default:return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,a(t,e)]:[...n,[a(t,e),"=",a(r,e)].join("")]}}(t),i={};for(const t of Object.keys(e))n(t)||(i[t]=e[t]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map(n=>{const i=e[n];return void 0===i?"":null===i?a(n,t):Array.isArray(i)?i.reduce(r(n),[]).join("&"):a(n,t)+"="+a(i,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=o(e,"#");return Object.assign({url:n.split("?")[0]||"",query:h(l(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:u(r,t)}:{})},t.stringifyUrl=(e,n)=>{n=Object.assign({encode:!0,strict:!0},n);const r=d(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),s=Object.assign(o,e.query);let c=t.stringify(s,n);c&&(c="?"+c);let u=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(u="#"+a(e.fragmentIdentifier,n)),`${r}${c}${u}`},t.pick=(e,n,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:i,query:o,fragmentIdentifier:c}=t.parseUrl(e,r);return t.stringifyUrl({url:i,query:s(o,n),fragmentIdentifier:c},r)},t.exclude=(e,n,r)=>{const i=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,i,r)}},function(e,t,n){"use strict";function r(e){let t=void 0;return"undefined"!=typeof window&&void 0!==window[e]&&(t=window[e]),t}function i(e){const t=r(e);if(!t)throw new Error(e+" is not defined in Window");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalStorage=t.getLocalStorageOrThrow=t.getCrypto=t.getCryptoOrThrow=t.getLocation=t.getLocationOrThrow=t.getNavigator=t.getNavigatorOrThrow=t.getDocument=t.getDocumentOrThrow=t.getFromWindowOrThrow=t.getFromWindow=void 0,t.getFromWindow=r,t.getFromWindowOrThrow=i,t.getDocumentOrThrow=function(){return i("document")},t.getDocument=function(){return r("document")},t.getNavigatorOrThrow=function(){return i("navigator")},t.getNavigator=function(){return r("navigator")},t.getLocationOrThrow=function(){return i("location")},t.getLocation=function(){return r("location")},t.getCryptoOrThrow=function(){return i("crypto")},t.getCrypto=function(){return r("crypto")},t.getLocalStorageOrThrow=function(){return i("localStorage")},t.getLocalStorage=function(){return r("localStorage")}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{}},function(e,t,n){"use strict";var r=n(63);n.o(r,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return r.ERROR_BAD_MAC})),n.o(r,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return r.IV_LENGTH})),n.o(r,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return r.KEY_LENGTH})),n.o(r,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return r.LENGTH_0})),n.o(r,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return r.MAC_LENGTH})),n.o(r,"assert")&&n.d(t,"assert",(function(){return r.assert})),n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return r.isConstantTime}));n(64);var i=n(65);n.o(i,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return i.ERROR_BAD_MAC})),n.o(i,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return i.IV_LENGTH})),n.o(i,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return i.KEY_LENGTH})),n.o(i,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return i.LENGTH_0})),n.o(i,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return i.MAC_LENGTH})),n.o(i,"assert")&&n.d(t,"assert",(function(){return i.assert})),n.o(i,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return i.decryptWithSharedKey})),n.o(i,"derive")&&n.d(t,"derive",(function(){return i.derive})),n.o(i,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return i.encryptWithSharedKey})),n.o(i,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return i.generateKeyPair})),n.o(i,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return i.isConstantTime}));var o=n(66);n.d(t,"assert",(function(){return o.a})),n.d(t,"isConstantTime",(function(){return o.b}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcHistory=void 0;const r=n(5),i=n(10),o=n(17),s=n(12),c=n(8),a=n(11),u=n(9);class d extends o.IJsonRpcHistory{constructor(e,t){super(e,t),this.logger=e,this.storage=t,this.records=new Map,this.events=new i.EventEmitter,this.name=u.HISTORY_CONTEXT,this.cached=[],this.logger=a.generateChildLogger(e,this.name),this.storage=t,this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return a.getLoggerContext(this.logger)}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(void 0!==t.response)return;const n={topic:t.topic,request:c.formatJsonRpcRequest(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:n}),this.records.has(t.id))return;const r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n};this.records.set(r.id,r),this.events.emit(u.HISTORY_EVENTS.created,r)}))}resolve(e){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=yield this.getRecord(e.id);void 0===t.response&&(t.response=c.isJsonRpcError(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.events.emit(u.HISTORY_EVENTS.updated,t))}))}get(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t});const n=yield this.getRecord(t);if(n.topic!==e){const e=s.ERROR.MISMATCHED_TOPIC.format({context:s.formatMessageContext(this.context),id:t});throw new Error(e.message)}return n}))}delete(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(n=>{if(n.topic===e){if(void 0!==t&&n.id!==t)return;this.records.delete(n.id),this.events.emit(u.HISTORY_EVENTS.deleted,n)}})}))}exists(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),!this.records.has(t))return!1;return(yield this.getRecord(t)).topic===e}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getRecord(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.records.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:s.formatMessageContext(this.context),id:e});throw new Error(t.message)}return t}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.storage.setJsonRpcRecords(this.context,this.values),this.events.emit(u.HISTORY_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.storage.getJsonRpcRecords(this.context);if(void 0===e)return;if(!e.length)return;if(this.records.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored records for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug("Failed to Restore records for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.records.set(e.id,e))}onInit(){this.cached=[],this.events.emit(u.HISTORY_EVENTS.init)}isInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(u.HISTORY_EVENTS.init,()=>e())})}))}registerEventListeners(){this.events.on(u.HISTORY_EVENTS.created,e=>{const t=u.HISTORY_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.updated,e=>{const t=u.HISTORY_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.deleted,e=>{const t=u.HISTORY_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}}t.JsonRpcHistory=d},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var r=n(10),i=n(19),o=n(8);const s=void 0!==e.WebSocket?e.WebSocket:n(134);class c{constructor(e){if(this.url=e,this.events=new r.EventEmitter,this.registering=!1,!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);this.url=e}get connected(){return void 0!==this.socket}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(void 0===this.socket)throw new Error("Connection already closed");this.socket.close()}async send(e,t){void 0===this.socket&&(this.socket=await this.register());try{this.socket.send(Object(i.safeJsonStringify)(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);return this.registering?new Promise((e,t)=>{this.events.once("register_error",e=>{t(e)}),this.events.once("open",()=>{if(void 0===this.socket)return t(new Error("WebSocket connection is missing or invalid"));e(this.socket)})}):(this.url=e,this.registering=!0,new Promise((t,n)=>{const r=Object(o.isReactNative)()?void 0:{rejectUnauthorized:!Object(o.isLocalhostUrl)(e)},i=new s(e,[],r);i.onopen=()=>{this.onOpen(i),t(i)},i.onerror=e=>{const t=this.parseError(e.error);this.events.emit("register_error",t),this.onClose(),n(t)}}))}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=()=>this.onClose(),e.onerror=e=>{const t=this.parseError(e.error);this.events.emit("error",t)},this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(void 0===e.data)return;const t="string"==typeof e.data?Object(i.safeJsonParse)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),r=n.message||n.toString(),i=Object(o.formatJsonRpcError)(e,r);this.events.emit("payload",i)}parseError(e,t=this.url){return Object(o.parseConnectionError)(e,t,"WS")}}t.b=c}).call(this,n(25))},function(e,t,n){"use strict";const r=n(93);e.exports=s;const i=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{},o={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:function(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const n in e)void 0===t[n]&&(t[n]=e[n]);return t}};function s(e){(e=e||{}).browser=e.browser||{};const t=e.browser.transmit;if(t&&"function"!=typeof t.send)throw Error("pino: transmit option must have a send function");const n=e.browser.write||i;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},o=function(e,t){if(Array.isArray(e)){return e.filter((function(e){return"!stdSerializers.err"!==e}))}return!0===e&&Object.keys(t)}(e.browser.serialize,r);let a=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(a=!1);"function"==typeof n&&(n.error=n.fatal=n.warn=n.info=n.debug=n.trace=n),!1===e.enabled&&(e.level="silent");const l=e.level||"info",p=Object.create(n);p.log||(p.log=E),Object.defineProperty(p,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(p,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,c(g,p,"error","log"),c(g,p,"fatal","error"),c(g,p,"warn","error"),c(g,p,"info","log"),c(g,p,"debug","log"),c(g,p,"trace","log")}});const g={transmit:t,serialize:o,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:h(e)};return p.levels=s.levels,p.level=l,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=E,p.serializers=r,p._serialize=o,p._stdErrSerialize=a,p.child=function(n,i){if(!n)throw new Error("missing bindings for child Pino");i=i||{},o&&n.serializers&&(i.serializers=n.serializers);const s=i.serializers;if(o&&s){var c=Object.assign({},r,s),a=!0===e.browser.serialize?Object.keys(c):o;delete n.serializers,u([n],a,c,this._stdErrSerialize)}function l(e){this._childLevel=1+(0|e._childLevel),this.error=d(e,n,"error"),this.fatal=d(e,n,"fatal"),this.warn=d(e,n,"warn"),this.info=d(e,n,"info"),this.debug=d(e,n,"debug"),this.trace=d(e,n,"trace"),c&&(this.serializers=c,this._serialize=a),t&&(this._logEvent=f([].concat(e._logEvent.bindings,n)))}return l.prototype=this,new l(this)},t&&(p._logEvent=f()),p}function c(e,t,n,r){const o=Object.getPrototypeOf(t);t[n]=t.levelVal>t.levels.values[n]?E:o[n]?o[n]:i[n]||i[r]||E,function(e,t,n){if(!e.transmit&&t[n]===E)return;t[n]=(r=t[n],function(){const o=e.timestamp(),c=new Array(arguments.length),d=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var f=0;f<c.length;f++)c[f]=arguments[f];if(e.serialize&&!e.asObject&&u(c,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?r.call(d,a(this,n,c,o)):r.apply(d,c),e.transmit){const r=e.transmit.level||t.level,i=s.levels.values[r],a=s.levels.values[n];if(a<i)return;l(this,{ts:o,methodLevel:n,methodValue:a,transmitLevel:r,transmitValue:s.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},c)}});var r}(e,t,n)}function a(e,t,n,i){e._serialize&&u(n,e._serialize,e.serializers,e._stdErrSerialize);const o=n.slice();let c=o[0];const a={};i&&(a.time=i),a.level=s.levels.values[t];let d=1+(0|e._childLevel);if(d<1&&(d=1),null!==c&&"object"==typeof c){for(;d--&&"object"==typeof o[0];)Object.assign(a,o.shift());c=o.length?r(o.shift(),o):void 0}else"string"==typeof c&&(c=r(o.shift(),o));return void 0!==c&&(a.msg=c),a}function u(e,t,n,r){for(const i in e)if(r&&e[i]instanceof Error)e[i]=s.stdSerializers.err(e[i]);else if("object"==typeof e[i]&&!Array.isArray(e[i]))for(const r in e[i])t&&t.indexOf(r)>-1&&r in n&&(e[i][r]=n[r](e[i][r]))}function d(e,t,n){return function(){const r=new Array(1+arguments.length);r[0]=t;for(var i=1;i<r.length;i++)r[i]=arguments[i-1];return e[n].apply(this,r)}}function l(e,t,n){const r=t.send,i=t.ts,o=t.methodLevel,s=t.methodValue,c=t.val,a=e._logEvent.bindings;u(n,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=n.filter((function(e){return-1===a.indexOf(e)})),e._logEvent.level.label=o,e._logEvent.level.value=s,r(o,e._logEvent,c),e._logEvent=f(a)}function f(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function h(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?y:_}function p(){return{}}function g(e){return e}function E(){}function y(){return!1}function _(){return Date.now()}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=o,s.stdTimeFunctions=Object.assign({},{nullTime:y,epochTime:_,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const r=n(5),i=n(17),o=n(12),s=n(8),c=n(9);class a extends i.IEngine{constructor(e){super(e),this.sequence=e,this.registerEventListeners()}find(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.sequence.values.filter(t=>{var n,r,i,s,c,a;let u=!1;return(null===(n=t.permissions)||void 0===n?void 0:n.jsonrpc)&&(null===(r=e.jsonrpc)||void 0===r?void 0:r.methods)&&o.hasOverlap(e.jsonrpc.methods,t.permissions.jsonrpc.methods)&&(u=!0),(null===(i=t.permissions)||void 0===i?void 0:i.blockchain)&&(null===(s=e.blockchain)||void 0===s?void 0:s.chains)&&o.hasOverlap(e.blockchain.chains,t.permissions.blockchain.chains)&&(u=!0),(null===(c=t.permissions)||void 0===c?void 0:c.notifications)&&(null===(a=e.notifications)||void 0===a?void 0:a.types)&&o.hasOverlap(e.notifications.types,t.permissions.notifications.types)&&(u=!0),u})}))}ping(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n={method:this.sequence.config.jsonrpc.ping,params:{}};return this.request({topic:e,request:n,timeout:t||o.toMiliseconds(c.THIRTY_SECONDS)})}))}send(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=t,i=yield this.sequence.settled.get(e);let o=!1;if(s.isJsonRpcRequest(t)&&!Object.values(this.sequence.config.jsonrpc).includes(t.method)){yield this.isJsonRpcAuthorized(e,i.self,t),yield this.sequence.validateRequest({topic:e,request:t,chainId:n});const r={chainId:n,request:{method:t.method,params:t.params}};r.chainId||delete r.chainId,o=!0,t=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.payload,r,t.id)}yield this.sequence.client.relayer.publish(i.topic,t,{relay:i.relay,prompt:o}),(s.isJsonRpcResponse(r)||s.isJsonRpcRequest(r)&&!Object.values(this.sequence.config.jsonrpc).includes(r.method))&&(yield this.recordPayloadEvent({topic:e,payload:r,chainId:n}))}))}get length(){return this.sequence.settled.length}get topics(){return this.sequence.settled.topics}get values(){return this.sequence.settled.values}create(e){return new Promise((t,n)=>r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Create "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"create",params:e});const i=(null==e?void 0:e.timeout)||o.toMiliseconds(c.FIVE_MINUTES),s=setTimeout(()=>{const e=o.ERROR.SETTLE_TIMEOUT.format({context:this.sequence.name,timeout:i});this.sequence.logger.error(e.message),n(e.message)},i);let a;try{a=yield this.propose(e)}catch(e){return clearTimeout(s),n(e)}this.sequence.pending.on(c.STORE_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){if(a.topic===e.sequence.topic&&o.isSequenceResponded(e.sequence)){const r=e.sequence.outcome;if(clearTimeout(s),o.isSequenceFailed(r)){try{yield this.sequence.pending.delete(a.topic,r.reason)}catch(e){return n(e)}n(new Error(r.reason.message))}else try{const e=yield this.sequence.settled.get(r.topic),n=o.ERROR.SETTLED.format({context:this.sequence.name});yield this.sequence.pending.delete(a.topic,n),t(e)}catch(e){return n(e)}}})))})))}respond(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Respond "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"respond",params:e}),yield this.sequence.validateRespond(e);const{approved:t,proposal:n,response:r}=e,{relay:i,ttl:s}=n,c={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==r?void 0:r.metadata};if(c.metadata||delete c.metadata,!t){const t=o.ERROR.NOT_APPROVED.format({context:this.sequence.name}),r={reason:(null==e?void 0:e.reason)||t},s={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:c,proposal:n,outcome:r};return yield this.sequence.pending.set(s.topic,s),s}try{const e={publicKey:c.publicKey,metadata:null==r?void 0:r.metadata};e.metadata||delete e.metadata;const t=o.calcExpiry(n.ttl),a=(null==r?void 0:r.state)||{},u={publicKey:n.proposer.publicKey,metadata:n.proposer.metadata};u.metadata||delete u.metadata;const d=n.proposer.controller?{publicKey:u.publicKey}:{publicKey:c.publicKey},l=Object.assign(Object.assign({},n.permissions),{controller:d}),f={topic:(yield this.settle({relay:i,self:c,peer:u,permissions:l,state:a,ttl:s,expiry:t})).topic,relay:i,state:a,responder:e,expiry:t},h={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:c,proposal:n,outcome:f};return yield this.sequence.pending.set(h.topic,h),h}catch(e){const t={reason:o.ERROR.GENERIC.format({message:e.message})},r={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:c,proposal:n,outcome:t};return yield this.sequence.pending.set(r.topic,r),r}}))}update(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Update "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"update",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey},r=yield this.handleUpdate(e.topic,e,n),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.update,r);return yield this.send(t.topic,i),t}))}upgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Upgrade "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"upgrade",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey},r=yield this.handleUpgrade(e.topic,e,n),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.upgrade,r);return yield this.send(t.topic,i),t}))}extend(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Extend "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"extend",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey};if(e.ttl>(yield this.sequence.getDefaultTTL())){const e=o.ERROR.INVALID_EXTEND_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}let r={expiry:o.calcExpiry(e.ttl)};r=yield this.handleExtension(e.topic,r,n);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.extend,r);return yield this.send(t.topic,i),t}))}request(e){return r.__awaiter(this,void 0,void 0,(function*(){return new Promise((t,n)=>r.__awaiter(this,void 0,void 0,(function*(){try{yield this.sequence.validateRequest(e)}catch(e){return n(e)}const r=s.formatJsonRpcRequest(e.request.method,e.request.params),i=(null==e?void 0:e.timeout)||o.toMiliseconds(c.FIVE_MINUTES),a=setTimeout(()=>{const e=o.ERROR.JSONRPC_REQUEST_TIMEOUT.format({method:r.method,timeout:i});this.sequence.logger.error(e.message),n(e.message)},i);this.sequence.events.on(this.sequence.config.events.response,i=>{if(e.topic!==i.topic)return;const o=i.response;if(o.id===r.id){if(clearTimeout(a),s.isJsonRpcError(o)){const e=o.error.message;return this.sequence.logger.error(e),n(new Error(e))}return t(o.result)}});try{yield this.send(e.topic,r,null==e?void 0:e.chainId)}catch(e){return clearTimeout(a),n(e)}})))}))}delete(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Delete "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"delete",params:e}),yield this.sequence.settled.delete(e.topic,e.reason)}))}notify(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,notification:n}=e,r=yield this.sequence.settled.get(e.topic);yield this.isNotificationAuthorized(e.topic,r.self,n.type);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.notification,n);yield this.send(e.topic,i)}))}propose(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Propose "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"propose",params:e}),yield this.sequence.validatePropose(e);const t=(null==e?void 0:e.relay)||{protocol:c.RELAYER_DEFAULT_PROTOCOL},n=o.generateRandomBytes32(),r={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==e?void 0:e.metadata};r.metadata||delete r.metadata;const i={publicKey:r.publicKey,controller:this.sequence.client.controller,metadata:r.metadata};i.metadata||delete i.metadata;const s={relay:t,topic:n,proposer:i,signal:(null==e?void 0:e.signal)||(yield this.sequence.getDefaultSignal({topic:n,relay:t,proposer:i})),permissions:(null==e?void 0:e.permissions)||(yield this.sequence.getDefaultPermissions()),ttl:(null==e?void 0:e.ttl)||(yield this.sequence.getDefaultTTL())},a={status:this.sequence.config.status.proposed,topic:s.topic,relay:s.relay,self:r,proposal:s};return yield this.sequence.pending.set(a.topic,a),a}))}settle(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Settle "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"settle",params:e});const t={topic:yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer),relay:e.relay,self:e.self,peer:e.peer,permissions:e.permissions,expiry:e.expiry,state:e.state,acknowledged:!1};return yield this.sequence.settled.set(t.topic,t),t}))}onResponse(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} response`),this.sequence.logger.trace({type:"method",method:"onResponse",topic:t,payload:n});const r=n,i=r.params,c=yield this.sequence.pending.get(t);let a,u;if(o.isSequenceRejected(i))this.sequence.logger.error(i.reason),yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:{reason:i.reason}});else{try{const e=c.proposal.proposer.controller?{publicKey:c.proposal.proposer.publicKey}:{publicKey:i.responder.publicKey},n={publicKey:i.responder.publicKey,metadata:i.responder.metadata};n.metadata||delete n.metadata;const r=i.state||{},o=Object.assign(Object.assign({},c.proposal.permissions),{controller:e}),s=yield this.settle({relay:c.relay,self:c.self,peer:n,permissions:o,ttl:c.proposal.ttl,expiry:i.expiry,state:r}),a={topic:s.topic,relay:s.relay,responder:i.responder,expiry:s.expiry,state:s.state};yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:a})}catch(e){this.sequence.logger.error(e),a=o.ERROR.GENERIC.format({message:e.message}),u={reason:a},yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:u})}yield this.sequence.client.relayer.publish(c.topic,void 0===a?s.formatJsonRpcResult(r.id,!0):s.formatJsonRpcError(r.id,a),{relay:c.relay}),void 0===u||o.isSequenceFailed(u)||(yield this.sequence.settled.update(u.topic,{acknowledged:!0}))}}))}onAcknowledge(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} acknowledge`),this.sequence.logger.trace({type:"method",method:"onAcknowledge",topic:t,payload:n});const r=n,i=yield this.sequence.pending.get(t);if(!o.isSequenceResponded(i))return;const{outcome:c}=i;s.isJsonRpcError(r)&&!o.isSequenceFailed(c)&&(yield this.sequence.settled.delete(c.topic,r.error)),void 0===c||o.isSequenceFailed(c)||(yield this.sequence.settled.update(c.topic,{acknowledged:!0}));const a=o.ERROR.RESPONSE_ACKNOWLEDGED.format({context:this.sequence.name});yield this.sequence.pending.delete(t,a)}))}onMessage(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(this.sequence.logger.debug(`Receiving ${this.sequence.context} message`),this.sequence.logger.trace({type:"method",method:"onMessage",topic:t,payload:n}),s.isJsonRpcRequest(n)){const t=n,r=yield this.sequence.settled.get(e.topic);let i;switch(t.method){case this.sequence.config.jsonrpc.payload:yield this.onPayload(e);break;case this.sequence.config.jsonrpc.update:yield this.onUpdate(e);break;case this.sequence.config.jsonrpc.upgrade:yield this.onUpgrade(e);break;case this.sequence.config.jsonrpc.extend:yield this.onExtension(e);break;case this.sequence.config.jsonrpc.notification:yield this.onNotification(e);break;case this.sequence.config.jsonrpc.delete:yield this.sequence.settled.delete(r.topic,t.params.reason);break;case this.sequence.config.jsonrpc.ping:yield this.send(r.topic,s.formatJsonRpcResult(t.id,!0));break;default:i=o.ERROR.UNKNOWN_JSONRPC_METHOD.format({method:t.method}),this.sequence.logger.error(i.message),yield this.send(r.topic,s.formatJsonRpcError(t.id,i))}}else this.onPayloadEvent(e)}))}onPayload(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(s.isJsonRpcRequest(n)){const{id:e,params:r}=n,{chainId:i}=r,o=s.formatJsonRpcRequest(r.request.method,r.request.params,e),c=yield this.sequence.settled.get(t);yield this.isJsonRpcAuthorized(t,c.peer,o),yield this.sequence.validateRequest({topic:t,request:o,chainId:i});const a={topic:t,payload:o,chainId:i};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},a)),this.onPayloadEvent(a)}else{const e={topic:t,payload:n};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},e)),this.onPayloadEvent(e)}}))}onUpdate(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} update`),this.sequence.logger.trace({type:"method",method:"onUpdate",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpdate(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onUpgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} upgrade`),this.sequence.logger.trace({type:"method",method:"onUpgrade",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpgrade(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onExtension(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} extension`),this.sequence.logger.trace({type:"method",method:"onExtension",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleExtension(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onNotification(e){return r.__awaiter(this,void 0,void 0,(function*(){const{params:t}=e.payload,n=e.payload,r=yield this.sequence.settled.get(e.topic);try{yield this.isNotificationAuthorized(e.topic,r.peer,t.type);const i={topic:e.topic,notification:t},o=this.sequence.config.events.notification;this.sequence.logger.info("Emitting "+o),this.sequence.logger.debug({type:"event",event:o,notificationEvent:i}),this.sequence.events.emit(o,i);const c=s.formatJsonRpcResult(n.id,!0);yield this.send(r.topic,c)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(n.id,e.message);yield this.send(r.topic,t)}}))}handleUpdate(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.state){const e=o.ERROR.INVALID_UPDATE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPDATE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const i=yield this.sequence.mergeUpdate(e,t);return yield this.sequence.settled.update(r.topic,{state:i}),t}))}handleUpgrade(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.permissions){const e=o.ERROR.INVALID_UPGRADE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPGRADE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const i=yield this.sequence.mergeUpgrade(e,t);return yield this.sequence.settled.update(r.topic,{permissions:i}),t}))}handleExtension(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.expiry){const e=o.ERROR.INVALID_EXTEND_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_EXTEND_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}return t=yield this.sequence.mergeExtension(e,t),yield this.sequence.settled.update(r.topic,t),t}))}isJsonRpcAuthorized(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(t.publicKey!==r.permissions.controller.publicKey&&!r.permissions.jsonrpc.methods.includes(n.method)){const e=o.ERROR.UNAUTHORIZED_JSON_RPC_METHOD.format({method:n.method});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}isNotificationAuthorized(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(t.publicKey!==r.permissions.controller.publicKey&&r.self.publicKey!==r.permissions.controller.publicKey&&!r.permissions.notifications.types.includes(n)){const e=o.ERROR.UNAUTHORIZED_NOTIFICATION_TYPE.format({type:n});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}recordPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,chainId:r}=e;s.isJsonRpcRequest(n)?yield this.sequence.history.set(t,n,r):yield this.sequence.history.resolve(n)}))}shouldIgnorePayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(!this.sequence.settled.sequences.has(t))return!0;let r=!1;try{if(s.isJsonRpcRequest(n))r=yield this.sequence.history.exists(t,n.id);else{let e;try{e=yield this.sequence.history.get(t,n.id)}catch(e){}r=void 0!==e&&void 0!==e.response}}catch(e){}return r}))}onPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,chainId:r}=e;if(!(yield this.shouldIgnorePayloadEvent(e))){if(s.isJsonRpcRequest(n)){const e={topic:t,request:n,chainId:r},i=this.sequence.config.events.request;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,sequence:e}),this.sequence.events.emit(i,e)}else{const e={topic:t,response:n,chainId:r},i=this.sequence.config.events.response;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,sequence:e}),this.sequence.events.emit(i,e)}yield this.recordPayloadEvent(e)}}))}onPendingPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){if(s.isJsonRpcRequest(e.payload))switch(e.payload.method){case this.sequence.config.jsonrpc.approve:case this.sequence.config.jsonrpc.reject:this.onResponse(e)}else this.onAcknowledge(e)}))}onPendingStatusEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t}=e;if(o.isSignalTypePairing(t.proposal.signal)&&!(yield this.sequence.client.crypto.hasKeys(t.proposal.topic))){const e=yield this.sequence.client.pairing.settled.get(t.proposal.signal.params.topic);yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer,t.proposal.topic)}if(o.isSequenceResponded(t)){const n=this.sequence.config.events.responded;if(this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,sequence:t}),this.sequence.events.emit(n,t),!o.isStoreUpdatedEvent(e)){const{topic:e,outcome:n,relay:r}=t,i=o.isSequenceFailed(n)?this.sequence.config.jsonrpc.reject:this.sequence.config.jsonrpc.approve,c=o.isSequenceFailed(n)?{reason:n.reason}:{relay:n.relay,responder:n.responder,expiry:n.expiry,state:n.state},a=s.formatJsonRpcRequest(i,c);yield this.sequence.client.relayer.publish(e,a,{relay:r})}}else{const e=this.sequence.config.events.proposed;if(this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t}),this.sequence.events.emit(e,t),o.isSignalTypePairing(t.proposal.signal)){const e=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.propose,t.proposal);yield this.sequence.client.pairing.send(t.proposal.signal.params.topic,e)}}}))}subscribeNewPending(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,sequence:n}=e,r=o.calcExpiry(c.ONE_DAY);yield this.sequence.client.relayer.subscribe(t,{relay:n.relay}),yield this.sequence.expirer.set(t,{topic:t,expiry:r})}))}subscribeNewSettled(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,sequence:n}=e,{expiry:r}=n;yield this.sequence.client.relayer.subscribe(t,{relay:n.relay}),yield this.sequence.expirer.set(t,{topic:t,expiry:r})}))}registerEventListeners(){this.sequence.pending.on(c.STORE_EVENTS.created,e=>r.__awaiter(this,void 0,void 0,(function*(){yield this.subscribeNewPending(e),yield this.onPendingStatusEvent(e)}))),this.sequence.pending.on(c.STORE_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){return yield this.onPendingStatusEvent(e)}))),this.sequence.pending.on(c.STORE_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t}=e;yield this.sequence.client.relayer.unsubscribe(t.topic,{relay:t.relay}),yield this.sequence.expirer.del(t.topic)}))),this.sequence.settled.on(c.STORE_EVENTS.created,e=>r.__awaiter(this,void 0,void 0,(function*(){yield this.subscribeNewSettled(e);const{sequence:t}=e,n=this.sequence.config.events.settled;this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,sequence:t}),this.sequence.events.emit(n,t)}))),this.sequence.settled.on(c.STORE_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t,update:n}=e;if(void 0!==n.state){const e=this.sequence.config.events.updated;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,update:n}),this.sequence.events.emit(e,t,n)}else if(void 0!==n.permissions){const e=this.sequence.config.events.upgraded,r=n;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,upgrade:r}),this.sequence.events.emit(e,t,r)}else if(void 0!==n.expiry){const e=this.sequence.config.events.extended,r=n;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,extension:r}),this.sequence.events.emit(e,t,r)}}))),this.sequence.settled.on(c.STORE_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t,reason:n}=e,r=this.sequence.config.events.deleted;this.sequence.logger.info("Emitting "+r),this.sequence.logger.debug({type:"event",event:r,sequence:t,reason:n}),this.sequence.events.emit(r,t,n);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.delete,{reason:n});yield this.sequence.history.delete(t.topic),yield this.sequence.client.relayer.publish(t.topic,i,{relay:t.relay}),yield this.sequence.client.relayer.unsubscribe(t.topic,{relay:t.relay}),yield this.sequence.expirer.del(t.topic)}))),this.sequence.settled.on(c.STORE_EVENTS.sync,()=>this.sequence.events.emit(this.sequence.config.events.sync)),this.sequence.client.relayer.on(c.RELAYER_EVENTS.payload,e=>{this.sequence.pending.sequences.has(e.topic)?this.onPendingPayloadEvent(e):this.sequence.settled.sequences.has(e.topic)&&this.onMessage(e)}),this.sequence.expirer.on(c.EXPIRER_EVENTS.expired,e=>r.__awaiter(this,void 0,void 0,(function*(){if(this.sequence.pending.sequences.has(e.topic)){const t=o.ERROR.EXPIRED.format({context:o.formatMessageContext(this.sequence.pending.context)});this.sequence.pending.delete(e.topic,t)}else{const t=o.ERROR.EXPIRED.format({context:o.formatMessageContext(this.sequence.settled.context)});this.sequence.settled.delete(e.topic,t)}})))}}t.Engine=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Expirer=void 0;const r=n(5),i=n(10),o=n(17),s=n(11),c=n(12),a=n(9);class u extends o.IExpirer{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.expirations=new Map,this.events=new i.EventEmitter,this.name=a.EXPIRER_CONTEXT,this.cached=[],this.client,this.logger=s.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return s.getLoggerContext(this.logger)}get length(){return this.expirations.size}get topics(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}has(e){return r.__awaiter(this,void 0,void 0,(function*(){try{return void 0!==this.getExpiration(e)}catch(e){return!1}}))}set(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.expirations.set(e,t),this.checkExpiry(e,t),this.events.emit(a.EXPIRER_EVENTS.created,{topic:e,expiration:t})}))}get(e){return r.__awaiter(this,void 0,void 0,(function*(){return yield this.isInitialized(),this.getExpiration(e)}))}del(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.getExpiration(e);this.expirations.delete(e),this.events.emit(a.EXPIRER_EVENTS.deleted,{topic:e,expiration:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setSequenceStore(this.context,this.values),this.events.emit(a.EXPIRER_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getSequenceStore(this.context);if(void 0===e)return;if(!e.length)return;if(this.expirations.size){const e=c.ERROR.RESTORE_WILL_OVERRIDE.format({context:c.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored expirations for "+c.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug("Failed to Restore expirations for "+c.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.expirations.set(e.topic,e))}onInit(){this.cached=[],this.events.emit(a.EXPIRER_EVENTS.init)}isInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(a.EXPIRER_EVENTS.init,()=>e())})}))}getExpiration(e){const t=this.expirations.get(e);if(!t){const t=c.ERROR.NO_MATCHING_ID.format({context:c.formatMessageContext(this.context),topic:e});throw new Error(t.message)}return t}checkExpiry(e,t){const{expiry:n}=t;c.toMiliseconds(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(a.EXPIRER_EVENTS.expired,{topic:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.client.heartbeat.on(a.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(a.EXPIRER_EVENTS.created,e=>{const t=a.EXPIRER_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.EXPIRER_EVENTS.expired,e=>{const t=a.EXPIRER_EVENTS.expired;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.EXPIRER_EVENTS.deleted,e=>{const t=a.EXPIRER_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Expirer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const r=n(5),i=n(10),o=n(17),s=n(12),c=n(9),a=n(11);class u extends o.IStore{constructor(e,t,n){super(e,t,n),this.client=e,this.logger=t,this.name=n,this.sequences=new Map,this.events=new i.EventEmitter,this.cached=[],this.logger=a.generateChildLogger(t,this.name),this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return a.getLoggerContext(this.logger)}get length(){return this.sequences.size}get topics(){return Array.from(this.sequences.keys())}get values(){return Array.from(this.sequences.values())}set(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.sequences.has(e)?this.update(e,t):(this.logger.debug("Setting sequence"),this.logger.trace({type:"method",method:"set",topic:e,sequence:t}),this.sequences.set(e,t),this.events.emit(c.STORE_EVENTS.created,{topic:e,sequence:t}))}))}get(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Getting sequence"),this.logger.trace({type:"method",method:"get",topic:e});return yield this.getSequence(e)}))}update(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Updating sequence"),this.logger.trace({type:"method",method:"update",topic:e,update:t});const n=Object.assign(Object.assign({},yield this.getSequence(e)),t);this.sequences.set(e,n),this.events.emit(c.STORE_EVENTS.updated,{topic:e,sequence:n,update:t})}))}delete(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),!this.sequences.has(e))return;this.logger.debug("Deleting sequence"),this.logger.trace({type:"method",method:"delete",topic:e,reason:t});const n=yield this.getSequence(e);this.sequences.delete(e),this.events.emit(c.STORE_EVENTS.deleted,{topic:e,sequence:n,reason:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getSequence(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.sequences.get(e);if(!t){const t=s.ERROR.NO_MATCHING_TOPIC.format({context:s.formatMessageContext(this.context),topic:e});throw this.logger.error(t.message),new Error(t.message)}return t}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setSequenceStore(this.context,this.values),this.events.emit(c.STORE_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getSequenceStore(this.context);if(void 0===e)return;if(!e.length)return;if(this.sequences.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored sequences for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",sequences:this.values})}catch(e){this.logger.debug("Failed to Restore sequences for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.sequences.set(e.topic,e))}onInit(){this.cached=[],this.events.emit(c.STORE_EVENTS.init)}isInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(c.STORE_EVENTS.init,()=>e())})}))}registerEventListeners(){this.events.on(c.STORE_EVENTS.created,e=>{const t=c.STORE_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(c.STORE_EVENTS.updated,e=>{const t=c.STORE_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(c.STORE_EVENTS.deleted,e=>{const t=c.STORE_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Store=u},function(e,t){e.exports=i,i.strict=o,i.loose=s;var n=Object.prototype.toString,r={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(e){return o(e)||s(e)}function o(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return r[n.call(e)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(104),i=n(32);function o(e){var t=new Float64Array(16);if(e)for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;var s=new Uint8Array(32);s[0]=9;var c=o([56129,1]);function a(e){for(var t=1,n=0;n<16;n++){var r=e[n]+t+65535;t=Math.floor(r/65536),e[n]=r-65536*t}e[0]+=t-1+37*(t-1)}function u(e,t,n){for(var r=~(n-1),i=0;i<16;i++){var o=r&(e[i]^t[i]);e[i]^=o,t[i]^=o}}function d(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]+n[r]}function l(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]-n[r]}function f(e,t,n){var r,i,o=0,s=0,c=0,a=0,u=0,d=0,l=0,f=0,h=0,p=0,g=0,E=0,y=0,_=0,v=0,R=0,m=0,S=0,T=0,O=0,N=0,b=0,I=0,w=0,A=0,P=0,C=0,U=0,L=0,D=0,x=0,M=n[0],q=n[1],j=n[2],H=n[3],V=n[4],K=n[5],G=n[6],B=n[7],k=n[8],Y=n[9],J=n[10],F=n[11],z=n[12],X=n[13],W=n[14],Q=n[15];o+=(r=t[0])*M,s+=r*q,c+=r*j,a+=r*H,u+=r*V,d+=r*K,l+=r*G,f+=r*B,h+=r*k,p+=r*Y,g+=r*J,E+=r*F,y+=r*z,_+=r*X,v+=r*W,R+=r*Q,s+=(r=t[1])*M,c+=r*q,a+=r*j,u+=r*H,d+=r*V,l+=r*K,f+=r*G,h+=r*B,p+=r*k,g+=r*Y,E+=r*J,y+=r*F,_+=r*z,v+=r*X,R+=r*W,m+=r*Q,c+=(r=t[2])*M,a+=r*q,u+=r*j,d+=r*H,l+=r*V,f+=r*K,h+=r*G,p+=r*B,g+=r*k,E+=r*Y,y+=r*J,_+=r*F,v+=r*z,R+=r*X,m+=r*W,S+=r*Q,a+=(r=t[3])*M,u+=r*q,d+=r*j,l+=r*H,f+=r*V,h+=r*K,p+=r*G,g+=r*B,E+=r*k,y+=r*Y,_+=r*J,v+=r*F,R+=r*z,m+=r*X,S+=r*W,T+=r*Q,u+=(r=t[4])*M,d+=r*q,l+=r*j,f+=r*H,h+=r*V,p+=r*K,g+=r*G,E+=r*B,y+=r*k,_+=r*Y,v+=r*J,R+=r*F,m+=r*z,S+=r*X,T+=r*W,O+=r*Q,d+=(r=t[5])*M,l+=r*q,f+=r*j,h+=r*H,p+=r*V,g+=r*K,E+=r*G,y+=r*B,_+=r*k,v+=r*Y,R+=r*J,m+=r*F,S+=r*z,T+=r*X,O+=r*W,N+=r*Q,l+=(r=t[6])*M,f+=r*q,h+=r*j,p+=r*H,g+=r*V,E+=r*K,y+=r*G,_+=r*B,v+=r*k,R+=r*Y,m+=r*J,S+=r*F,T+=r*z,O+=r*X,N+=r*W,b+=r*Q,f+=(r=t[7])*M,h+=r*q,p+=r*j,g+=r*H,E+=r*V,y+=r*K,_+=r*G,v+=r*B,R+=r*k,m+=r*Y,S+=r*J,T+=r*F,O+=r*z,N+=r*X,b+=r*W,I+=r*Q,h+=(r=t[8])*M,p+=r*q,g+=r*j,E+=r*H,y+=r*V,_+=r*K,v+=r*G,R+=r*B,m+=r*k,S+=r*Y,T+=r*J,O+=r*F,N+=r*z,b+=r*X,I+=r*W,w+=r*Q,p+=(r=t[9])*M,g+=r*q,E+=r*j,y+=r*H,_+=r*V,v+=r*K,R+=r*G,m+=r*B,S+=r*k,T+=r*Y,O+=r*J,N+=r*F,b+=r*z,I+=r*X,w+=r*W,A+=r*Q,g+=(r=t[10])*M,E+=r*q,y+=r*j,_+=r*H,v+=r*V,R+=r*K,m+=r*G,S+=r*B,T+=r*k,O+=r*Y,N+=r*J,b+=r*F,I+=r*z,w+=r*X,A+=r*W,P+=r*Q,E+=(r=t[11])*M,y+=r*q,_+=r*j,v+=r*H,R+=r*V,m+=r*K,S+=r*G,T+=r*B,O+=r*k,N+=r*Y,b+=r*J,I+=r*F,w+=r*z,A+=r*X,P+=r*W,C+=r*Q,y+=(r=t[12])*M,_+=r*q,v+=r*j,R+=r*H,m+=r*V,S+=r*K,T+=r*G,O+=r*B,N+=r*k,b+=r*Y,I+=r*J,w+=r*F,A+=r*z,P+=r*X,C+=r*W,U+=r*Q,_+=(r=t[13])*M,v+=r*q,R+=r*j,m+=r*H,S+=r*V,T+=r*K,O+=r*G,N+=r*B,b+=r*k,I+=r*Y,w+=r*J,A+=r*F,P+=r*z,C+=r*X,U+=r*W,L+=r*Q,v+=(r=t[14])*M,R+=r*q,m+=r*j,S+=r*H,T+=r*V,O+=r*K,N+=r*G,b+=r*B,I+=r*k,w+=r*Y,A+=r*J,P+=r*F,C+=r*z,U+=r*X,L+=r*W,D+=r*Q,R+=(r=t[15])*M,s+=38*(S+=r*j),c+=38*(T+=r*H),a+=38*(O+=r*V),u+=38*(N+=r*K),d+=38*(b+=r*G),l+=38*(I+=r*B),f+=38*(w+=r*k),h+=38*(A+=r*Y),p+=38*(P+=r*J),g+=38*(C+=r*F),E+=38*(U+=r*z),y+=38*(L+=r*X),_+=38*(D+=r*W),v+=38*(x+=r*Q),o=(r=(o+=38*(m+=r*q))+(i=1)+65535)-65536*(i=Math.floor(r/65536)),s=(r=s+i+65535)-65536*(i=Math.floor(r/65536)),c=(r=c+i+65535)-65536*(i=Math.floor(r/65536)),a=(r=a+i+65535)-65536*(i=Math.floor(r/65536)),u=(r=u+i+65535)-65536*(i=Math.floor(r/65536)),d=(r=d+i+65535)-65536*(i=Math.floor(r/65536)),l=(r=l+i+65535)-65536*(i=Math.floor(r/65536)),f=(r=f+i+65535)-65536*(i=Math.floor(r/65536)),h=(r=h+i+65535)-65536*(i=Math.floor(r/65536)),p=(r=p+i+65535)-65536*(i=Math.floor(r/65536)),g=(r=g+i+65535)-65536*(i=Math.floor(r/65536)),E=(r=E+i+65535)-65536*(i=Math.floor(r/65536)),y=(r=y+i+65535)-65536*(i=Math.floor(r/65536)),_=(r=_+i+65535)-65536*(i=Math.floor(r/65536)),v=(r=v+i+65535)-65536*(i=Math.floor(r/65536)),R=(r=R+i+65535)-65536*(i=Math.floor(r/65536)),o=(r=(o+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(r/65536)),s=(r=s+i+65535)-65536*(i=Math.floor(r/65536)),c=(r=c+i+65535)-65536*(i=Math.floor(r/65536)),a=(r=a+i+65535)-65536*(i=Math.floor(r/65536)),u=(r=u+i+65535)-65536*(i=Math.floor(r/65536)),d=(r=d+i+65535)-65536*(i=Math.floor(r/65536)),l=(r=l+i+65535)-65536*(i=Math.floor(r/65536)),f=(r=f+i+65535)-65536*(i=Math.floor(r/65536)),h=(r=h+i+65535)-65536*(i=Math.floor(r/65536)),p=(r=p+i+65535)-65536*(i=Math.floor(r/65536)),g=(r=g+i+65535)-65536*(i=Math.floor(r/65536)),E=(r=E+i+65535)-65536*(i=Math.floor(r/65536)),y=(r=y+i+65535)-65536*(i=Math.floor(r/65536)),_=(r=_+i+65535)-65536*(i=Math.floor(r/65536)),v=(r=v+i+65535)-65536*(i=Math.floor(r/65536)),R=(r=R+i+65535)-65536*(i=Math.floor(r/65536)),o+=i-1+37*(i-1),e[0]=o,e[1]=s,e[2]=c,e[3]=a,e[4]=u,e[5]=d,e[6]=l,e[7]=f,e[8]=h,e[9]=p,e[10]=g,e[11]=E,e[12]=y,e[13]=_,e[14]=v,e[15]=R}function h(e,t){f(e,t,t)}function p(e,t){for(var n=new Uint8Array(32),r=new Float64Array(80),i=o(),s=o(),p=o(),g=o(),E=o(),y=o(),_=0;_<31;_++)n[_]=e[_];n[31]=127&e[31]|64,n[0]&=248,function(e,t){for(var n=0;n<16;n++)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}(r,t);for(_=0;_<16;_++)s[_]=r[_];i[0]=g[0]=1;for(_=254;_>=0;--_){var v=n[_>>>3]>>>(7&_)&1;u(i,s,v),u(p,g,v),d(E,i,p),l(i,i,p),d(p,s,g),l(s,s,g),h(g,E),h(y,i),f(i,p,i),f(p,s,E),d(E,i,p),l(i,i,p),h(s,i),l(p,g,y),f(i,p,c),d(i,i,g),f(p,p,i),f(i,g,y),f(g,s,r),h(s,E),u(i,s,v),u(p,g,v)}for(_=0;_<16;_++)r[_+16]=i[_],r[_+32]=p[_],r[_+48]=s[_],r[_+64]=g[_];var R=r.subarray(32),m=r.subarray(16);!function(e,t){for(var n=o(),r=0;r<16;r++)n[r]=t[r];for(r=253;r>=0;r--)h(n,n),2!==r&&4!==r&&f(n,n,t);for(r=0;r<16;r++)e[r]=n[r]}(R,R),f(m,m,R);var S=new Uint8Array(32);return function(e,t){for(var n=o(),r=o(),i=0;i<16;i++)r[i]=t[i];a(r),a(r),a(r);for(var s=0;s<2;s++){n[0]=r[0]-65517;for(i=1;i<15;i++)n[i]=r[i]-65535-(n[i-1]>>16&1),n[i-1]&=65535;n[15]=r[15]-32767-(n[14]>>16&1);var c=n[15]>>16&1;n[14]&=65535,u(r,n,1-c)}for(i=0;i<16;i++)e[2*i]=255&r[i],e[2*i+1]=r[i]>>8}(S,m),S}function g(e){return p(e,s)}function E(e){if(e.length!==t.SECRET_KEY_LENGTH)throw new Error("x25519: seed must be "+t.SECRET_KEY_LENGTH+" bytes");var n=new Uint8Array(e);return{publicKey:g(n),secretKey:n}}t.scalarMult=p,t.scalarMultBase=g,t.generateKeyPairFromSeed=E,t.generateKeyPair=function(e){var t=r.randomBytes(32,e),n=E(t);return i.wipe(t),n},t.sharedKey=function(e,n,r){if(void 0===r&&(r=!1),e.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(n.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");var i=p(e,n);if(r){for(var o=0,s=0;s<i.length;s++)o|=i[s];if(0===o)throw new Error("X25519: invalid shared key")}return i}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(94)),s=n(39),c=n(95);class a{constructor(){this.localStorage=o.default}getKeys(){return r(this,void 0,void 0,(function*(){return Object.keys(this.localStorage)}))}getEntries(){return r(this,void 0,void 0,(function*(){return Object.entries(this.localStorage).map(c.parseEntry)}))}getItem(e){return r(this,void 0,void 0,(function*(){const t=this.localStorage.getItem(e);if(null!==t)return s.safeJsonParse(t)}))}setItem(e,t){return r(this,void 0,void 0,(function*(){this.localStorage.setItem(e,s.safeJsonStringify(t))}))}removeItem(e){return r(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}}t.KeyValueStorage=a,t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=function(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}},t.safeJsonStringify=function(e){return"string"==typeof e?e:JSON.stringify(e,(e,t)=>void 0===t?null:t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e){super(),this.protocol="wc",this.version=2}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s}));var r=n(26);class i extends r.a{constructor(e){super()}}class o extends r.a{constructor(){super()}}class s extends o{constructor(e){super()}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));class r{constructor(e,t){this.client=e,this.logger=t}}class i{constructor(e,t,n){this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e,t){this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.sequence=e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e){super()}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.logger=e,this.storage=t,this.records=new Map}}},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);class i extends r.a{}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(2);class i{}class o extends r.IEvents{constructor(e){super()}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);class i extends r.a{}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t,n){super(),this.client=e,this.logger=t,this.name=n}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}));class r{constructor(e,t,n){this.logger=e,this.keyValueStorage=t,this.config=n}}class i extends r{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}}class o extends i{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(2);class i{constructor(){this.map=new Map}}class o extends r.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(6);function i(e){return r.getBrowerCrypto().getRandomValues(new Uint8Array(e))}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var a,u=[],d=!1,l=-1;function f(){d&&a&&(d=!1,a.length?u=a.concat(u):l=-1,u.length&&h())}function h(){if(!d){var e=c(f);d=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||d||c(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(14);function i(e,t,n){return Object(r.b)(e,t,n)}function o(e,t,n){return Object(r.a)(e,t,n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var r=n(14),i=n(27);async function o(e,t){return await Object(r.c)(e,t)}async function s(e,t,n){const o=await Object(r.c)(e,t);return Object(i.isConstantTime)(o,n)}},function(e,t,n){"use strict";var r=n(6);n.o(r,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return r.ERROR_BAD_MAC})),n.o(r,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return r.IV_LENGTH})),n.o(r,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return r.KEY_LENGTH})),n.o(r,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return r.LENGTH_0})),n.o(r,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return r.MAC_LENGTH})),n.o(r,"assert")&&n.d(t,"assert",(function(){return r.assert})),n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return r.isConstantTime}))},function(e,t,n){"use strict"},function(e,t){},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(14);async function i(e){return await Object(r.e)(e)}async function o(e){return await Object(r.f)(e)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return a}));var r=n(3),i=n(1),o=n(15);async function s(e){const t=await Object(r.sha512)(e);return{encryptionKey:Object(o.d)(t),macKey:Object(o.e)(t)}}async function c(e,t,n,c=Object(r.randomBytes)(r.IV_LENGTH)){const{encryptionKey:a,macKey:u}=await s(t),d=await Object(r.aesCbcEncrypt)(c,a,e),l=Object(i.concatArrays)(c,n,d),f=await Object(r.hmacSha256Sign)(u,l);return Object(o.h)({iv:c,publicKey:n,ciphertext:d,mac:f})}async function a(e,t){const{iv:n,publicKey:c,mac:a,ciphertext:u}=Object(o.b)(e),{encryptionKey:d,macKey:l}=await s(t),f=Object(i.concatArrays)(n,c,u),h=await Object(r.hmacSha256Verify)(l,f,a);Object(r.assert)(h,r.ERROR_BAD_MAC);return await Object(r.aesCbcDecrypt)(n,d,u)}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(101),i=n(102),o=n(103);function s(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function c(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=a.prototype:(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);a.TYPED_ARRAY_SUPPORT?(e=t).__proto__=a.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=c(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(a.isBuffer(t)){var n=0|h(t.length);return 0===(e=c(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?c(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(d(t),e=c(e,t<0?0:0|h(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|h(t.length);e=c(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return b(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return N(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function E(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){var o,s=1,c=e.length,a=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,c/=2,a/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var d=-1;for(o=n;o<c;o++)if(u(e,o)===u(t,-1===d?0:o-d)){if(-1===d&&(d=o),o-d+1===a)return d*s}else-1!==d&&(o-=o-d),d=-1}else for(n+a>c&&(n=c-a),o=n;o>=0;o--){for(var l=!0,f=0;f<a;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var c=parseInt(t.substr(2*s,2),16);if(isNaN(c))return s;e[n+s]=c}return s}function R(e,t,n,r){return G(V(t,e.length-n),e,n,r)}function m(e,t,n,r){return G(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return m(e,t,n,r)}function T(e,t,n,r){return G(K(t),e,n,r)}function O(e,t,n,r){return G(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function N(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function b(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,c,a,u=e[i],d=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(d=u);break;case 2:128==(192&(o=e[i+1]))&&(a=(31&u)<<6|63&o)>127&&(d=a);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(a=(15&u)<<12|(63&o)<<6|63&s)>2047&&(a<55296||a>57343)&&(d=a);break;case 4:o=e[i+1],s=e[i+2],c=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&c)&&(a=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&c)>65535&&a<1114112&&(d=a)}null===d?(d=65533,l=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),i+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=a,t.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return u(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return function(e,t,n,r){return d(t),t<=0?c(e,t):void 0!==n?"string"==typeof r?c(e,t).fill(n,r):c(e,t).fill(n):c(e,t)}(null,e,t,n)},a.allocUnsafe=function(e){return l(null,e)},a.allocUnsafeSlow=function(e){return l(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!a.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},a.byteLength=p,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)E(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?b(this,0,e):g.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),c=Math.min(o,s),u=this.slice(r,i),d=e.slice(t,n),l=0;l<c;++l)if(u[l]!==d[l]){o=u[l],s=d[l];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return R(this,e,t,n);case"ascii":return m(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function w(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=H(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function x(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,r,o){return o||x(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function q(e,t,n,r,o){return o||x(e,0,n,8),i.write(e,t,n,r,52,8),n+8}a.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=a.prototype;else{var i=t-e;n=new a(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=0,s=1,c=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===c&&0!==this[t+o-1]&&(c=1),this[t+o]=(e/s>>0)-c&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=n-1,s=1,c=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===c&&0!==this[t+o+1]&&(c=1),this[t+o]=(e/s>>0)-c&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return q(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return q(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:V(new a(e,r).toString()),c=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%c]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function K(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function G(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(25))},function(e,t){},function(e,t,n){"use strict";n(7),n(16)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const r={waku:{info:"waku_info",connect:"waku_connect",disconnect:"waku_disconnect",publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"}}},function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeJs",(function(){return o}));var r=n(6);for(var i in r)["default","isNodeJs"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);const o=r.isNode},function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return u}));var r=n(20),i=n(4);function o(){return Date.now()*Math.pow(10,3)+Math.floor(Math.random()*Math.pow(10,3))}function s(e,t,n){return{id:n||o(),jsonrpc:"2.0",method:e,params:t}}function c(e,t){return{id:e,jsonrpc:"2.0",result:t}}function a(e,t){return{id:e,jsonrpc:"2.0",error:u(t)}}function u(e){return void 0===e?Object(r.a)(i.a):("string"==typeof e&&(e=Object.assign(Object.assign({},Object(r.a)(i.g)),{message:e})),Object(r.c)(e.code)&&(e=Object(r.b)(e.code)),e)}},function(e,t,n){"use strict";function r(e){return e.includes("*")?o(e):!/\W/g.test(e)}function i(e){return"*"===e}function o(e){return!!i(e)||!!e.includes("*")&&(2===e.split("*").length&&1===e.split("*").filter(e=>""===e.trim()).length)}function s(e){return!i(e)&&o(e)&&!e.split("*")[0].trim()}function c(e){return!i(e)&&o(e)&&!e.split("*")[1].trim()}n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return c}))},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s}));function r(e,t){const n=function(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}(e);return void 0!==n&&new RegExp(t).test(n)}function i(e){return r(e,"^https?:")}function o(e){return r(e,"^wss?:")}function s(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}},function(e,t,n){"use strict";function r(e){return"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function i(e){return r(e)&&"method"in e}function o(e){return r(e)&&(s(e)||c(e))}function s(e){return"result"in e}function c(e){return"error"in e}function a(e){return"error"in e&&!1===e.valid}n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"f",(function(){return a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PINO_CUSTOM_CONTEXT_KEY=t.PINO_LOGGER_DEFAULTS=void 0,t.PINO_LOGGER_DEFAULTS={level:"info",prettyPrint:{colorize:!0,translateTime:"SYS:standard",ignore:"pid,hostname"}},t.PINO_CUSTOM_CONTEXT_KEY="custom_context"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayerEncoder=t.Encoder=void 0;const r=n(5),i=r.__importStar(n(1)),o=n(11),s=n(19),c=n(9);t.Encoder=class{constructor(e,t){this.client=e,this.logger=t,this.name=c.ENCODER_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name)}get context(){return o.getLoggerContext(this.logger)}encode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=s.safeJsonStringify(t);return(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.encrypt(e,n):i.utf8ToHex(n)}))}decode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.decrypt(e,t):i.hexToUtf8(t);return s.safeJsonParse(n)}))}};t.RelayerEncoder=class{encode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return i.utf8ToHex(s.safeJsonStringify(t))}))}decode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return s.safeJsonParse(i.hexToUtf8(t))}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeat=void 0;const r=n(5),i=r.__importDefault(n(31)),o=n(10),s=n(17),c=n(9),a=n(11),u=n(12);class d extends s.IHeartBeat{constructor(e){super(e),this.events=new o.EventEmitter,this.interval=c.HEARTBEAT_INTERVAL,this.name=c.HEARTBEAT_CONTEXT,this.logger=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?a.generateChildLogger(e.logger,this.name):i.default(a.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||c.HEARTBEAT_DEFAULT_LOGGER})),this.interval=(null==e?void 0:e.interval)||c.HEARTBEAT_INTERVAL}static init(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new d(e);return yield t.init(),t}))}get context(){return a.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){setInterval(()=>this.pulse(),u.toMiliseconds(this.interval)),this.logger.trace("Initialized")}))}pulse(){this.events.emit(c.HEARTBEAT_EVENTS.pulse)}}t.HeartBeat=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=t.SubscriberTopicMap=void 0;const r=n(5),i=n(10),o=n(17),s=n(12),c=n(11),a=n(9);class u{constructor(){this.map=new Map}get topics(){return Array.from(this.map.keys())}set(e,t){const n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])}get(e){return this.map.get(e)||[]}exists(e,t){return this.get(e).includes(t)}delete(e,t){if(void 0===t)return void this.map.delete(e);if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,t))return;const r=n.filter(e=>e!==t);r.length?this.map.set(e,r):this.map.delete(e)}clear(){this.map.clear()}}t.SubscriberTopicMap=u;class d extends o.ISubscriber{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new u,this.events=new i.EventEmitter,this.name=a.SUBSCRIBER_CONTEXT,this.pending=new Map,this.cached=[],this.relayer=e,this.logger=c.generateChildLogger(t,this.name),this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return c.getLoggerContext(this.logger)}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}subscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const n=s.getRelayProtocolName(t),r={topic:e,relay:n};this.pending.set(e,r);const i=yield this.rpcSubscribe(e,n);return yield this.onSubscribe(i,r),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}}),i}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}))}unsubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){void 0!==(null==t?void 0:t.id)?yield this.unsubscribeById(e,t.id,t):yield this.unsubscribeByTopic(e,t)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}enable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length&&this.onEnable()}))}disable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length||this.onDisable()}))}hasSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled();let n=!1;try{n=(yield this.getSubscription(e)).topic===t}catch(e){}return n}))}onEnable(){this.cached=[],this.events.emit(a.SUBSCRIBER_EVENTS.enabled)}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.events.emit(a.SUBSCRIBER_EVENTS.disabled)}unsubscribeByTopic(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.topicMap.get(e);yield Promise.all(n.map(n=>r.__awaiter(this,void 0,void 0,(function*(){return yield this.unsubscribeById(e,n,t)}))))}))}unsubscribeById(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}});try{const r=s.getRelayProtocolName(n);yield this.rpcUnsubscribe(e,t,r);const i=s.ERROR.DELETED.format({context:s.formatMessageContext(this.context)});yield this.onUnsubscribe(e,t,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}))}rpcSubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n={method:s.getRelayProtocolApi(t.protocol).subscribe,params:{topic:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}))}rpcUnsubscribe(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r={method:s.getRelayProtocolApi(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}))}onSubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.setSubscription(e,Object.assign(Object.assign({},t),{id:e})),this.pending.delete(t.topic)}))}onResubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.addSubscription(e,Object.assign(Object.assign({},t),{id:e})),this.pending.delete(t.topic)}))}onUnsubscribe(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.events.removeAllListeners(t),(yield this.hasSubscription(t,e))&&(yield this.deleteSubscription(t,n)),yield this.relayer.history.delete(e)}))}setSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),yield this.addSubscription(e,t))}))}addSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.subscriptions.set(e,Object.assign({},t)),this.topicMap.set(t.topic,e),this.events.emit(a.SUBSCRIBER_EVENTS.created,t)}))}getSubscription(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:s.formatMessageContext(this.context),id:e});throw new Error(t.message)}return t}))}deleteSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const n=yield this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(a.SUBSCRIBER_EVENTS.deleted,Object.assign(Object.assign({},n),{reason:t}))}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.relayer.storage.setRelayerSubscriptions(this.context,this.values),this.events.emit(a.SUBSCRIBER_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.relayer.storage.getRelayerSubscriptions(this.context);if(void 0===e)return;if(!e.length)return;if(this.subscriptions.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}let t=[];const n=new Set;e.forEach(e=>{n.has(e.topic)||(n.add(e.topic),t.push(e))}),this.cached=t,this.logger.debug("Successfully Restored subscriptions for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug("Failed to Restore subscriptions for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),yield this.reset(),yield this.enable()}))}isEnabled(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(a.SUBSCRIBER_EVENTS.enabled,()=>e())})}))}reset(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length&&(yield Promise.all(this.cached.map(e=>r.__awaiter(this,void 0,void 0,(function*(){return this.resubscribe(e)})))))}))}resubscribe(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,relay:n}=e,r={topic:t,relay:n};this.pending.set(r.topic,r);const i=yield this.rpcSubscribe(r.topic,r.relay);if(yield this.onResubscribe(i,r),this.ids.includes(e.id)){const t=s.ERROR.RESUBSCRIBED.format({topic:e.topic});yield this.deleteSubscription(e.id,t)}}))}onConnect(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.reset(),yield this.enable()}))}onDisconnect(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.disable()}))}checkPending(){this.pending.forEach(e=>r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.rpcSubscribe(e.topic,e.relay);yield this.onSubscribe(t,e)})))}registerEventListeners(){this.relayer.heartbeat.on(a.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.provider.on(a.RELAYER_PROVIDER_EVENTS.connect,()=>r.__awaiter(this,void 0,void 0,(function*(){yield this.onConnect()}))),this.relayer.provider.on(a.RELAYER_PROVIDER_EVENTS.disconnect,()=>r.__awaiter(this,void 0,void 0,(function*(){yield this.onDisconnect()}))),this.events.on(a.SUBSCRIBER_EVENTS.created,e=>r.__awaiter(this,void 0,void 0,(function*(){const t=a.SUBSCRIBER_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),yield this.persist()}))),this.events.on(a.SUBSCRIBER_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const t=a.SUBSCRIBER_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),yield this.persist()})))}}t.Subscriber=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.RelayerStorage=t.BaseStorage=void 0;const r=n(5),i=n(11),o=n(12),s=n(9);class c{constructor(e,t,n){this.logger=e,this.keyValueStorage=t,this.config=n,this.name=s.STORAGE_CONTEXT,this.version=s.STORAGE_VERSION,this.keyMap=s.STORAGE_KEYS,this.logger=i.generateChildLogger(e,this.name),this.keyValueStorage=t,this.config=n}get context(){return i.getLoggerContext(this.logger)}get prefix(){return`${this.config.protocol}@${this.config.version}:${this.config.context}:${this.version}`}getStorageKey(e){const t=this.getStorageKeyName(e);if(!this.isValidStorageKeyName(t)){const e=o.ERROR.INVALID_STORAGE_KEY_NAME.format({name:t});throw new Error(e.message)}return this.prefix+"//"+t}getStorageKeyName(e){return o.formatStorageKeyName(e)}isValidStorageKeyName(e){return Object.keys(this.keyMap).map(e=>Object.values(this.keyMap[e])).flat().includes(e.toLowerCase())}}t.BaseStorage=c;class a extends c{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}setJsonRpcRecords(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getJsonRpcRecords(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}setRelayerSubscriptions(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getRelayerSubscriptions(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}}t.RelayerStorage=a;t.Storage=class extends a{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}setKeyChain(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,o.mapToObj(t))}))}getKeyChain(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e),n=yield this.keyValueStorage.getItem(t);return void 0!==n?o.objToMap(n):void 0}))}setSequenceStore(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getSequenceStore(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}setExpirations(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getExpirations(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s}));var r=n(28);class i extends r.a{constructor(e){super()}}class o extends r.a{constructor(){super()}}class s extends o{constructor(e){super()}}},function(e,t){},function(e,t,n){(function(t){var r=n(36).strict;e.exports=function(e){if(r(e)){var n=t.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(n=n.slice(e.byteOffset,e.byteOffset+e.byteLength)),n}return t.from(e)}}).call(this,n(69).Buffer)},function(e,t,n){(function(t){var n=/^\[object .+?Constructor\]$/,r="object"==typeof t&&t&&t.Object===Object&&t,i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();function s(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function c(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){var i=e.length,o=n+(r?1:-1);for(;r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,d,n);var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function a(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function u(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function d(e){return e!=e}function l(e,t){return e.has(t)}function f(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var h,p=Array.prototype,g=Function.prototype,E=Object.prototype,y=o["__core-js_shared__"],_=(h=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",v=g.toString,R=E.hasOwnProperty,m=E.toString,S=RegExp("^"+v.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=o.Symbol,O=E.propertyIsEnumerable,N=p.splice,b=T?T.isConcatSpreadable:void 0,I=Math.max,w=H(o,"Map"),A=H(o,"Set"),P=H(Object,"create");function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function U(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function L(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function D(e){var t=-1,n=e?e.length:0;for(this.__data__=new L;++t<n;)this.add(e[t])}function x(e,t){for(var n,r,i=e.length;i--;)if((n=e[i][0])===(r=t)||n!=n&&r!=r)return i;return-1}function M(e){return!(!z(e)||(t=e,_&&_ in t))&&(F(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?S:n).test(function(e){if(null!=e){try{return v.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}C.prototype.clear=function(){this.__data__=P?P(null):{}},C.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},C.prototype.get=function(e){var t=this.__data__;if(P){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return R.call(t,e)?t[e]:void 0},C.prototype.has=function(e){var t=this.__data__;return P?void 0!==t[e]:R.call(t,e)},C.prototype.set=function(e,t){return this.__data__[e]=P&&void 0===t?"__lodash_hash_undefined__":t,this},U.prototype.clear=function(){this.__data__=[]},U.prototype.delete=function(e){var t=this.__data__,n=x(t,e);return!(n<0)&&(n==t.length-1?t.pop():N.call(t,n,1),!0)},U.prototype.get=function(e){var t=this.__data__,n=x(t,e);return n<0?void 0:t[n][1]},U.prototype.has=function(e){return x(this.__data__,e)>-1},U.prototype.set=function(e,t){var n=this.__data__,r=x(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},L.prototype.clear=function(){this.__data__={hash:new C,map:new(w||U),string:new C}},L.prototype.delete=function(e){return j(this,e).delete(e)},L.prototype.get=function(e){return j(this,e).get(e)},L.prototype.has=function(e){return j(this,e).has(e)},L.prototype.set=function(e,t){return j(this,e).set(e,t),this},D.prototype.add=D.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},D.prototype.has=function(e){return this.__data__.has(e)};var q=A&&1/f(new A([,-0]))[1]==1/0?function(e){return new A(e)}:function(){};function j(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function H(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return M(n)?n:void 0}function V(e){return k(e)||function(e){return J(e)&&R.call(e,"callee")&&(!O.call(e,"callee")||"[object Arguments]"==m.call(e))}(e)||!!(b&&e&&e[b])}var K,G,B=(K=function(e){return function(e,t,n){var r=-1,i=c,o=e.length,s=!0,u=[],d=u;if(n)s=!1,i=a;else if(o>=200){var h=t?null:q(e);if(h)return f(h);s=!1,i=l,d=new D}else d=t?[]:u;e:for(;++r<o;){var p=e[r],g=t?t(p):p;if(p=n||0!==p?p:0,s&&g==g){for(var E=d.length;E--;)if(d[E]===g)continue e;t&&d.push(g),u.push(p)}else i(d,g,n)||(d!==u&&d.push(g),u.push(p))}return u}(function e(t,n,r,i,o){var s=-1,c=t.length;for(r||(r=V),o||(o=[]);++s<c;){var a=t[s];n>0&&r(a)?n>1?e(a,n-1,r,i,o):u(o,a):i||(o[o.length]=a)}return o}(e,1,J,!0))},G=I(void 0===G?K.length-1:G,0),function(){for(var e=arguments,t=-1,n=I(e.length-G,0),r=Array(n);++t<n;)r[t]=e[G+t];t=-1;for(var i=Array(G+1);++t<G;)i[t]=e[t];return i[G]=r,s(K,this,i)});var k=Array.isArray;function Y(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!F(e)}function J(e){return function(e){return!!e&&"object"==typeof e}(e)&&Y(e)}function F(e){var t=z(e)?m.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function z(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=B}).call(this,n(25))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWindowMetadata=void 0;const r=n(24);t.getWindowMetadata=function(){let e,t;try{e=r.getDocumentOrThrow(),t=r.getLocationOrThrow()}catch(e){return null}function n(...t){const n=e.getElementsByTagName("meta");for(let e=0;e<n.length;e++){const r=n[e],i=["itemprop","property","name"].map(e=>r.getAttribute(e)).filter(e=>!!e&&t.includes(e));if(i.length&&i){const e=r.getAttribute("content");if(e)return e}}return""}const i=function(){let t=n("name","og:site_name","og:title","twitter:title");return t||(t=e.title),t}();return{description:n("description","og:description","twitter:description","keywords"),url:t.origin,icons:function(){const n=e.getElementsByTagName("link"),r=[];for(let e=0;e<n.length;e++){const i=n[e],o=i.getAttribute("rel");if(o&&o.toLowerCase().indexOf("icon")>-1){const e=i.getAttribute("href");if(e)if(-1===e.toLowerCase().indexOf("https:")&&-1===e.toLowerCase().indexOf("http:")&&0!==e.indexOf("//")){let n=t.protocol+"//"+t.host;if(0===e.indexOf("/"))n+=e;else{const r=t.pathname.split("/");r.pop();n+=r.join("/")+"/"+e}r.push(n)}else if(0===e.indexOf("//")){const n=t.protocol+e;r.push(n)}else r.push(e)}}return r}(),name:i}}},function(e,t,n){"use strict";var r=n(70);n.o(r,"RELAY_JSONRPC")&&n.d(t,"RELAY_JSONRPC",(function(){return r.RELAY_JSONRPC}));n(71);var i=n(72);n.d(t,"RELAY_JSONRPC",(function(){return i.a}));n(16)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(5),i=n(92);r.__exportStar(n(9),t),t.Client=i.Client,t.default=i.Client},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(5),i=n(10),o=r.__importDefault(n(31)),s=r.__importDefault(n(38)),c=n(17),a=n(12),u=n(8),d=n(11),l=n(116),f=n(9);class h extends c.IClient{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new i.EventEmitter,this.name=f.CLIENT_DEFAULT.name;const t=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:o.default(d.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||f.CLIENT_DEFAULT.logger}));this.name=(null==e?void 0:e.name)||f.CLIENT_DEFAULT.name,this.controller=(null==e?void 0:e.controller)||f.CLIENT_DEFAULT.controller,this.metadata=(null==e?void 0:e.metadata)||a.getAppMetadata(),this.projectId=null==e?void 0:e.projectId,this.logger=d.generateChildLogger(t,this.name),this.heartbeat=new l.HeartBeat({logger:this.logger}),this.crypto=new l.Crypto(this,this.logger,null==e?void 0:e.keychain),this.encoder=new l.Encoder(this,this.logger);const n=Object.assign(Object.assign({},f.CLIENT_STORAGE_OPTIONS),null==e?void 0:e.storageOptions);this.storage=new l.Storage(this.logger,(null==e?void 0:e.storage)||new s.default(n),{protocol:this.protocol,version:this.version,context:this.context}),this.relayUrl=a.formatRelayRpcUrl(this.protocol,this.version,(null==e?void 0:e.relayUrl)||f.CLIENT_DEFAULT.relayUrl,this.projectId),this.relayer=new l.Relayer({rpcUrl:this.relayUrl,heartbeat:this.heartbeat,encoder:this.encoder,logger:this.logger,storage:this.storage,projectId:this.projectId,keyValueStorageOptions:n}),this.pairing=new l.Pairing(this,this.logger),this.session=new l.Session(this,this.logger)}static init(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new h(e);return yield t.initialize(),t}))}get context(){return d.getLoggerContext(this.logger)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}connect(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Connecting Application"),this.logger.trace({type:"method",method:"connect",params:e});try{void 0===typeof e.pairing&&this.logger.info("Connecing with existing pairing");const t=void 0===e.pairing?yield this.pairing.create():yield this.pairing.get(e.pairing.topic);this.logger.trace({type:"method",method:"connect",pairing:t});const n=e.metadata||this.metadata;if(void 0===n){const e=a.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const r=yield this.session.create({signal:{method:f.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}},relay:e.relay||{protocol:f.RELAYER_DEFAULT_PROTOCOL},metadata:n,permissions:Object.assign(Object.assign({},e.permissions),{notifications:f.SESSION_EMPTY_PERMISSIONS.notifications})});return this.logger.debug("Application Connection Successful"),this.logger.trace({type:"method",method:"connect",session:r}),r}catch(e){throw this.logger.debug("Application Connection Failure"),this.logger.error(e),e}}))}pair(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Pairing"),this.logger.trace({type:"method",method:"pair",params:e});const t=function(e){const t=a.parseUri(e);return{topic:t.topic,relay:t.relay,proposer:{publicKey:t.publicKey,controller:t.controller},signal:{method:f.PAIRING_SIGNAL_METHOD_URI,params:{uri:e}},permissions:{jsonrpc:{methods:[f.SESSION_JSONRPC.propose]},notifications:{types:[]}},ttl:f.PAIRING_DEFAULT_TTL}}(e.uri),n=t.proposer.controller!==this.controller,r=n?void 0:a.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),i=yield this.pairing.respond({approved:n,proposal:t,reason:r});if(!a.isPairingResponded(i)){const e=a.ERROR.NO_MATCHING_RESPONSE.format({context:"pairing"});throw this.logger.error(e.message),new Error(e.message)}if(a.isPairingFailed(i.outcome))throw this.logger.debug("Pairing Failure"),this.logger.trace({type:"method",method:"pair",outcome:i.outcome}),new Error(i.outcome.reason.message);this.logger.debug("Pairing Success"),this.logger.trace({type:"method",method:"pair",pending:i});return yield this.pairing.get(i.outcome.topic)}))}approve(e){return r.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Approving Session Proposal"),this.logger.trace({type:"method",method:"approve",params:e}),void 0===e.response){const e=a.ERROR.MISSING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}const t=e.response.state||f.SESSION_EMPTY_STATE,n=e.response.metadata||this.metadata;if(void 0===n){const e=a.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const r=e.proposal.proposer.controller!==this.controller,i=r?void 0:a.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),o=yield this.session.respond({approved:r,proposal:e.proposal,response:{state:t,metadata:n},reason:i});if(!a.isSessionResponded(o)){const e=a.ERROR.NO_MATCHING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}if(a.isSessionFailed(o.outcome))throw this.logger.debug("Session Proposal Approval Failure"),this.logger.trace({type:"method",method:"approve",outcome:o.outcome}),new Error(o.outcome.reason.message);return this.logger.debug("Session Proposal Approval Success"),this.logger.trace({type:"method",method:"approve",pending:o}),this.session.get(o.outcome.topic)}))}reject(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Rejecting Session Proposal"),this.logger.trace({type:"method",method:"reject",params:e});const t=yield this.session.respond({approved:!1,proposal:e.proposal,response:f.SESSION_EMPTY_RESPONSE,reason:e.reason});this.logger.debug("Session Proposal Response Success"),this.logger.trace({type:"method",method:"reject",pending:t})}))}update(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.update(e)}))}upgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.upgrade(e)}))}extend(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.extend(e)}))}request(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.session.request(e)}))}respond(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.send(e.topic,e.response)}))}ping(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.ping(e.topic,e.timeout)}))}notify(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.notify(e)}))}disconnect(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Disconnecting Application"),this.logger.trace({type:"method",method:"disconnect",params:e}),yield this.session.delete(e)}))}onPairingRequest(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(e.method===f.SESSION_JSONRPC.propose){const n=e.params;if(n.proposer.controller===this.controller){const e=a.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller});return void(yield this.session.respond({approved:!1,proposal:n,response:f.SESSION_EMPTY_RESPONSE,reason:e}))}const r=f.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:n}),this.events.emit(r,n);const i=u.formatJsonRpcResult(e.id,!0);yield this.pairing.send(t,i)}}))}onPairingSettled(e){return r.__awaiter(this,void 0,void 0,(function*(){e.permissions.controller.publicKey===e.self.publicKey&&void 0===e.state.metadata&&setTimeout(()=>r.__awaiter(this,void 0,void 0,(function*(){return yield this.pairing.update({topic:e.topic,state:{metadata:this.metadata}})})),f.CLIENT_SHORT_TIMEOUT)}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized");try{yield this.pairing.init(),yield this.session.init(),yield this.crypto.init(),yield this.relayer.init(),yield this.heartbeat.init(),this.registerEventListeners(),this.logger.info("Client Initilization Success")}catch(e){throw this.logger.info("Client Initilization Failure"),this.logger.error(e),e}}))}registerEventListeners(){this.pairing.on(f.PAIRING_EVENTS.proposed,e=>{const t=f.CLIENT_EVENTS.pairing.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.pairing.on(f.PAIRING_EVENTS.settled,e=>{const t=f.CLIENT_EVENTS.pairing.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e),this.onPairingSettled(e)}),this.pairing.on(f.PAIRING_EVENTS.updated,(e,t)=>{const n=f.CLIENT_EVENTS.pairing.updated;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,update:t}),this.events.emit(n,e,t)}),this.pairing.on(f.PAIRING_EVENTS.upgraded,(e,t)=>{const n=f.CLIENT_EVENTS.pairing.upgraded;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,upgrade:t}),this.events.emit(n,e,t)}),this.pairing.on(f.PAIRING_EVENTS.deleted,(e,t)=>{const n=f.CLIENT_EVENTS.pairing.deleted;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,reason:t}),this.events.emit(n,e,t)}),this.pairing.on(f.PAIRING_EVENTS.request,e=>{this.onPairingRequest(e.request,e.topic)}),this.session.on(f.PAIRING_EVENTS.sync,()=>this.events.emit(f.CLIENT_EVENTS.pairing.sync)),this.session.on(f.SESSION_EVENTS.proposed,e=>{const t=f.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.session.on(f.SESSION_EVENTS.settled,e=>{const t=f.CLIENT_EVENTS.session.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.updated,(e,t)=>{const n=f.CLIENT_EVENTS.session.updated;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,update:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.upgraded,(e,t)=>{const n=f.CLIENT_EVENTS.session.upgraded;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,upgrade:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.extended,(e,t)=>{const n=f.CLIENT_EVENTS.session.extended;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,extension:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.deleted,(e,t)=>{const n=f.CLIENT_EVENTS.session.deleted;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,reason:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.request,e=>{const t=f.CLIENT_EVENTS.session.request;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.response,e=>{const t=f.CLIENT_EVENTS.session.response;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.notification,e=>{const t=f.CLIENT_EVENTS.session.notification;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.sync,()=>this.events.emit(f.CLIENT_EVENTS.session.sync))}}t.Client=h},function(e,t,n){"use strict";function r(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,t,n){var i=n&&n.stringify||r;if("object"==typeof e&&null!==e){var o=t.length+1;if(1===o)return e;var s=new Array(o);s[0]=i(e);for(var c=1;c<o;c++)s[c]=i(t[c]);return s.join(" ")}if("string"!=typeof e)return e;var a=t.length;if(0===a)return e;for(var u="",d=0,l=-1,f=e&&e.length||0,h=0;h<f;){if(37===e.charCodeAt(h)&&h+1<f){switch(l=l>-1?l:0,e.charCodeAt(h+1)){case 100:case 102:if(d>=a)break;if(null==t[d])break;l<h&&(u+=e.slice(l,h)),u+=Number(t[d]),l=h+2,h++;break;case 105:if(d>=a)break;if(null==t[d])break;l<h&&(u+=e.slice(l,h)),u+=Math.floor(Number(t[d])),l=h+2,h++;break;case 79:case 111:case 106:if(d>=a)break;if(void 0===t[d])break;l<h&&(u+=e.slice(l,h));var p=typeof t[d];if("string"===p){u+="'"+t[d]+"'",l=h+2,h++;break}if("function"===p){u+=t[d].name||"<anonymous>",l=h+2,h++;break}u+=i(t[d]),l=h+2,h++;break;case 115:if(d>=a)break;l<h&&(u+=e.slice(l,h)),u+=String(t[d]),l=h+2,h++;break;case 37:l<h&&(u+=e.slice(l,h)),u+="%",l=h+2,h++,d--}++d}++h}if(-1===l)return e;l<f&&(u+=e.slice(l));return u}},function(e,t,n){(function(t){!function(){"use strict";var n;function r(){}(n=r).prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},n.prototype.setItem=function(e,t){this[e]=String(t)},n.prototype.removeItem=function(e){delete this[e]},n.prototype.clear=function(){var e=this;Object.keys(e).forEach((function(t){e[t]=void 0,delete e[t]}))},n.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},n.prototype.__defineGetter__("length",(function(){return Object.keys(this).length})),t.localStorage?e.exports=localStorage:e.exports=new r}()}).call(this,n(25))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(96)),r(n(98))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(97);t.IKeyValueStorage=r.IKeyValueStorage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IKeyValueStorage=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(39);function i(e){return t.REACT_NATIVE_REQUIRED_OPTION in e}function o(e){return t.NODE_JS_REQUIRED_OPTION in e}t.REACT_NATIVE_REQUIRED_OPTION="asyncStorage",t.isReactNativeOptions=i,t.getReactNativeOptions=function(e){if(void 0===e||!i(e))throw new Error(`Missing ${t.REACT_NATIVE_REQUIRED_OPTION} option required for React-Native`);return e},t.NODE_JS_REQUIRED_OPTION="database",t.isNodeJSOptions=o,t.getNodeJSOptions=function(e){if(void 0===e||!o(e))throw new Error(`Missing ${t.NODE_JS_REQUIRED_OPTION} option required for NodeJS`);return e},t.parseEntry=function(e){return[e[0],r.safeJsonParse(e[1])]}},function(e,t,n){"use strict";(function(e){function n(){return(null==e?void 0:e.crypto)||(null==e?void 0:e.msCrypto)||{}}function r(){const e=n();return e.subtle||e.webkitSubtle}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserCryptoAvailable=t.getSubtleCrypto=t.getBrowerCrypto=void 0,t.getBrowerCrypto=n,t.getSubtleCrypto=r,t.isBrowserCryptoAvailable=function(){return!!n()&&!!r()}}).call(this,n(25))},function(e,t,n){"use strict";(function(e){function n(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function r(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isNode=t.isReactNative=void 0,t.isReactNative=n,t.isNode=r,t.isBrowser=function(){return!n()&&!r()}}).call(this,n(60))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],c=r[1],a=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,c)),d=0,l=c>0?s-4:s;for(n=0;n<l;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],a[d++]=t>>16&255,a[d++]=t>>8&255,a[d++]=255&t;2===c&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,a[d++]=255&t);1===c&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,a[d++]=t>>8&255,a[d++]=255&t);return a},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,c=n-i;s<c;s+=16383)o.push(d(e,s,s+16383>c?c:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,a=s.length;c<a;++c)r[c]=s[c],i[s.charCodeAt(c)]=c;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function d(e,t,n){for(var i,o,s=[],c=t;c<n;c+=3)i=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(255&e[c+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,s,c=8*i-r-1,a=(1<<c)-1,u=a>>1,d=-7,l=n?i-1:0,f=n?-1:1,h=e[t+l];for(l+=f,o=h&(1<<-d)-1,h>>=-d,d+=c;d>0;o=256*o+e[t+l],l+=f,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=r;d>0;s=256*s+e[t+l],l+=f,d-=8);if(0===o)o=1-u;else{if(o===a)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=u}return(h?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,c,a,u=8*o-i-1,d=(1<<u)-1,l=d>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-s))<1&&(s--,a*=2),(t+=s+l>=1?f/a:f*Math.pow(2,1-l))*a>=2&&(s++,a/=2),s+l>=d?(c=0,s=d):s+l>=1?(c=(t*a-1)*Math.pow(2,i),s+=l):(c=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&c,h+=p,c/=256,i-=8);for(s=s<<i|c,u+=i;u>0;e[n+h]=255&s,h+=p,s/=256,u-=8);e[n+h-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(105),i=n(109),o=n(32);function s(e,n){return void 0===n&&(n=t.defaultRandomSource),n.randomBytes(e)}t.defaultRandomSource=new r.SystemRandomSource,t.randomBytes=s,t.randomUint32=function(e){void 0===e&&(e=t.defaultRandomSource);var n=s(4,e),r=i.readUint32LE(n);return o.wipe(n),r};var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function a(e,n,r){if(void 0===n&&(n=c),void 0===r&&(r=t.defaultRandomSource),n.length<2)throw new Error("randomString charset is too short");if(n.length>256)throw new Error("randomString charset is too long");for(var i="",a=n.length,u=256-256%a;e>0;){for(var d=s(Math.ceil(256*e/u),r),l=0;l<d.length&&e>0;l++){var f=d[l];f<u&&(i+=n.charAt(f%a),e--)}o.wipe(d)}return i}t.randomString=a,t.randomStringForEntropy=function(e,n,r){return void 0===n&&(n=c),void 0===r&&(r=t.defaultRandomSource),a(Math.ceil(e/(Math.log(n.length)/Math.LN2)),n,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(106),i=n(107),o=function(){function e(){return this.isAvailable=!1,this.name="",this._source=new r.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new i.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)},e}();t.SystemRandomSource=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");for(var t=new Uint8Array(e),n=0;n<t.length;n+=65536)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,65536)));return t},e}();t.BrowserRandomSource=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(32),i=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e=n(108);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");var t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");for(var n=new Uint8Array(e),i=0;i<n.length;i++)n[i]=t[i];return r.wipe(t),n},e}();t.NodeRandomSource=i},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(110);function i(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>8,t[n+1]=e>>>0,t}function o(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t}function s(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function c(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function a(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function u(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function d(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>24,t[n+1]=e>>>16,t[n+2]=e>>>8,t[n+3]=e>>>0,t}function l(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24,t}function f(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),d(e/4294967296>>>0,t,n),d(e>>>0,t,n+4),t}function h(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),l(e>>>0,t,n),l(e/4294967296>>>0,t,n+4),t}t.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},t.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},t.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},t.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},t.writeUint16BE=i,t.writeInt16BE=i,t.writeUint16LE=o,t.writeInt16LE=o,t.readInt32BE=s,t.readUint32BE=c,t.readInt32LE=a,t.readUint32LE=u,t.writeUint32BE=d,t.writeInt32BE=d,t.writeUint32LE=l,t.writeInt32LE=l,t.readInt64BE=function(e,t){void 0===t&&(t=0);var n=s(e,t),r=s(e,t+4);return 4294967296*n+r-4294967296*(r>>31)},t.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*c(e,t)+c(e,t+4)},t.readInt64LE=function(e,t){void 0===t&&(t=0);var n=a(e,t);return 4294967296*a(e,t+4)+n-4294967296*(n>>31)},t.readUint64LE=function(e,t){void 0===t&&(t=0);var n=u(e,t);return 4294967296*u(e,t+4)+n},t.writeUint64BE=f,t.writeInt64BE=f,t.writeUint64LE=h,t.writeInt64LE=h,t.readUintBE=function(e,t,n){if(void 0===n&&(n=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,i=1,o=e/8+n-1;o>=n;o--)r+=t[o]*i,i*=256;return r},t.readUintLE=function(e,t,n){if(void 0===n&&(n=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,i=1,o=n;o<n+e/8;o++)r+=t[o]*i,i*=256;return r},t.writeUintBE=function(e,t,n,i){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var o=1,s=e/8+i-1;s>=i;s--)n[s]=t/o&255,o*=256;return n},t.writeUintLE=function(e,t,n,i){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var o=1,s=i;s<i+e/8;s++)n[s]=t/o&255,o*=256;return n},t.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},t.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},t.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},t.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},t.writeFloat32BE=function(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e),t},t.writeFloat32LE=function(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),t},t.writeFloat64BE=function(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e),t},t.writeFloat64LE=function(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0},t.add=function(e,t){return e+t|0},t.sub=function(e,t){return e-t|0},t.rotl=function(e,t){return e<<t|e>>>32-t},t.rotr=function(e,t){return e<<32-t|e>>>t},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},function(e,t,n){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())},function(e,t,n){"use strict";var r=new RegExp("%[a-f0-9]{2}","gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function o(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],o(n),o(r))}function s(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(r),n=1;n<t.length;n++)t=(e=o(t,n).join("")).match(r);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},n=i.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=s(n[0]);r!==n[0]&&(t[n[0]]=r)}n=i.exec(e)}t["%C2"]="";for(var o=Object.keys(t),c=0;c<o.length;c++){var a=o[c];e=e.replace(new RegExp(a,"g"),t[a])}return e}(e)}}},function(e,t,n){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n={},r=Object.keys(e),i=Array.isArray(t),o=0;o<r.length;o++){var s=r[o],c=e[s];(i?-1!==t.indexOf(s):t(s,c,e))&&(n[s]=c)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateChildLogger=t.formatChildLoggerContext=t.getLoggerContext=t.setBrowserLoggerContext=t.getBrowserLoggerContext=t.getDefaultLoggerOptions=void 0;const r=n(79);function i(e,t=r.PINO_CUSTOM_CONTEXT_KEY){return e[t]||""}function o(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){return e[n]=t,e}function s(e,t=r.PINO_CUSTOM_CONTEXT_KEY){let n="";return n=void 0===e.bindings?i(e,t):e.bindings().context||"",n}function c(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){const i=s(e,n);return i.trim()?`${i}/${t}`:t}t.getDefaultLoggerOptions=function(e){return Object.assign(Object.assign({},e),{level:(null==e?void 0:e.level)||r.PINO_LOGGER_DEFAULTS.level,prettyPrint:(null==e?void 0:e.prettyPrint)||r.PINO_LOGGER_DEFAULTS.prettyPrint})},t.getBrowserLoggerContext=i,t.setBrowserLoggerContext=o,t.getLoggerContext=s,t.formatChildLoggerContext=c,t.generateChildLogger=function(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){const i=c(e,t,n);return o(e.child({context:i}),i,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);r.__exportStar(n(117),t),r.__exportStar(n(80),t),r.__exportStar(n(33),t),r.__exportStar(n(34),t),r.__exportStar(n(81),t),r.__exportStar(n(29),t),r.__exportStar(n(131),t),r.__exportStar(n(132),t),r.__exportStar(n(137),t),r.__exportStar(n(83),t),r.__exportStar(n(35),t),r.__exportStar(n(82),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Crypto=t.KeyChain=void 0;const r=n(5),i=r.__importStar(n(1)),o=n(11),s=n(19),c=n(12),a=n(9);class u{constructor(e,t){this.client=e,this.logger=t,this.keychain=new Map,this.name=a.KEYCHAIN_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name)}get context(){return o.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore()}))}has(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.keychain.set(e,t),yield this.persist()}))}get(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.keychain.get(e);if(void 0===t)throw new Error(c.ERROR.NO_MATCHING_KEY.format({tag:e}).message);return t}))}del(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.keychain.delete(e),yield this.persist()}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){const e=yield this.client.storage.getKeyChain(this.context);void 0!==e&&(this.keychain=e)}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setKeyChain(this.context,this.keychain)}))}}t.KeyChain=u;t.Crypto=class{constructor(e,t,n){this.client=e,this.logger=t,this.name=a.CRYPTO_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name),this.keychain=n||new u(this.client,this.logger)}get context(){return o.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.keychain.init()}))}hasKeys(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}generateKeyPair(){return r.__awaiter(this,void 0,void 0,(function*(){const e=c.generateKeyPair();return this.setKeyPair(e)}))}generateSharedKey(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.getKeyPair(e.publicKey),i=c.deriveSharedKey(r.privateKey,t.publicKey);return this.setEncryptionKeys({sharedKey:i,publicKey:r.publicKey},n)}))}encrypt(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:n,publicKey:r}=yield this.getEncryptionKeys(e);return yield c.encrypt({message:t,sharedKey:n,publicKey:r})}))}decrypt(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:n}=yield this.getEncryptionKeys(e);return yield c.decrypt({encrypted:t,sharedKey:n})}))}encode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=s.safeJsonStringify(t);return(yield this.hasKeys(e))?yield this.encrypt(e,n):i.utf8ToHex(n)}))}decode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=(yield this.hasKeys(e))?yield this.decrypt(e,t):i.hexToUtf8(t);return s.safeJsonParse(n)}))}concatKeys(e,t){return i.arrayToHex(i.concatArrays(i.hexToArray(e),i.hexToArray(t)))}splitKeys(e){const t=i.hexToArray(e);return[i.arrayToHex(t.slice(0,32)),i.arrayToHex(t.slice(32,64))]}setKeyPair(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.concatKeys(e.publicKey,e.privateKey);return yield this.keychain.set(e.publicKey,t),e.publicKey}))}getKeyPair(e){return r.__awaiter(this,void 0,void 0,(function*(){const[t,n]=this.splitKeys(yield this.keychain.get(e));return{publicKey:e,privateKey:n}}))}setEncryptionKeys(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=t||(yield c.sha256(e.sharedKey)),r=this.concatKeys(e.sharedKey,e.publicKey);return yield this.keychain.set(n,r),n}))}getEncryptionKeys(e){return r.__awaiter(this,void 0,void 0,(function*(){const[t,n]=this.splitKeys(yield this.keychain.get(e));return{sharedKey:t,publicKey:n}}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_STORAGE_OPTIONS=t.CLIENT_EVENTS=t.CLIENT_SHORT_TIMEOUT=t.CLIENT_DEFAULT=t.CLIENT_CONTEXT=void 0,t.CLIENT_CONTEXT="client",t.CLIENT_DEFAULT={name:t.CLIENT_CONTEXT,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},t.CLIENT_SHORT_TIMEOUT=50,t.CLIENT_EVENTS={pairing:{proposal:"pairing_proposal",updated:"pairing_updated",upgraded:"pairing_upgraded",extended:"pairing_extended",created:"pairing_created",deleted:"pairing_deleted",sync:"pairing_sync"},session:{proposal:"session_proposal",updated:"session_updated",upgraded:"session_upgraded",extended:"session_extended",created:"session_created",deleted:"session_deleted",notification:"session_notification",request:"session_request",response:"session_response",sync:"session_sync"}},t.CLIENT_STORAGE_OPTIONS={database:":memory:"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYCHAIN_CONTEXT=t.CRYPTO_CONTEXT=void 0,t.CRYPTO_CONTEXT="crypto",t.KEYCHAIN_CONTEXT="keychain"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENCODER_CONTEXT=void 0,t.ENCODER_CONTEXT="encoder"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXPIRER_DEFAULT_TTL=t.EXPIRER_EVENTS=t.EXPIRER_CONTEXT=void 0;const r=n(18);t.EXPIRER_CONTEXT="expirer",t.EXPIRER_EVENTS={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",init:"expirer_init",sync:"expirer_sync"},t.EXPIRER_DEFAULT_TTL=r.ONE_DAY},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_EVENTS=t.HEARTBEAT_DEFAULT_LOGGER=t.HEARTBEAT_INTERVAL=t.HEARTBEAT_CONTEXT=void 0;const r=n(18);t.HEARTBEAT_CONTEXT="heartbeat",t.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,t.HEARTBEAT_DEFAULT_LOGGER="error",t.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HISTORY_CONTEXT=t.HISTORY_EVENTS=void 0,t.HISTORY_EVENTS={created:"history_created",updated:"history_updated",deleted:"history_deleted",init:"history_init",sync:"history_sync"},t.HISTORY_CONTEXT="history"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAIRING_EVENTS=t.PAIRING_STATUS=t.PAIRING_SIGNAL_METHOD_URI=t.PAIRING_DEFAULT_TTL=t.PAIRING_CONTEXT=t.PAIRING_JSONRPC=void 0;const r=n(18);t.PAIRING_JSONRPC={propose:"wc_pairingPropose",approve:"wc_pairingApprove",reject:"wc_pairingReject",update:"wc_pairingUpdate",upgrade:"wc_pairingUpgrade",extend:"wc_pairingExtend",delete:"wc_pairingDelete",payload:"wc_pairingPayload",ping:"wc_pairingPing",notification:"wc_pairingNotification"},t.PAIRING_CONTEXT="pairing",t.PAIRING_DEFAULT_TTL=r.THIRTY_DAYS,t.PAIRING_SIGNAL_METHOD_URI="uri",t.PAIRING_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.PAIRING_EVENTS={proposed:"pairing_proposed",responded:"pairing_responded",settled:"pairing_settled",updated:"pairing_updated",upgraded:"pairing_upgraded",extended:"pairing_extended",deleted:"pairing_deleted",request:"pairing_request",response:"pairing_response",sync:"pairing_sync",notification:"pairing_notification"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PUBLISHER_CONTEXT=t.PUBLISHER_DEFAULT_TTL=void 0;const r=n(18);t.PUBLISHER_DEFAULT_TTL=r.SIX_HOURS,t.PUBLISHER_CONTEXT="publisher"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RELAYER_STORAGE_OPTIONS=t.RELAYER_RECONNECT_TIMEOUT=t.RELAYER_PROVIDER_EVENTS=t.RELAYER_SUBSCRIBER_SUFFIX=t.RELAYER_EVENTS=t.RELAYER_CONTEXT=t.RELAYER_DEFAULT_RELAY_URL=t.RELAYER_DEFAULT_LOGGER=t.RELAYER_DEFAULT_PROTOCOL=void 0;const r=n(18);t.RELAYER_DEFAULT_PROTOCOL="waku",t.RELAYER_DEFAULT_LOGGER="error",t.RELAYER_DEFAULT_RELAY_URL="wss://relay.walletconnect.com",t.RELAYER_CONTEXT="relayer",t.RELAYER_EVENTS={payload:"relayer_payload",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error"},t.RELAYER_SUBSCRIBER_SUFFIX="_subscription",t.RELAYER_PROVIDER_EVENTS={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},t.RELAYER_RECONNECT_TIMEOUT=r.ONE_SECOND,t.RELAYER_STORAGE_OPTIONS={database:":memory:"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SESSION_EMPTY_RESPONSE=t.SESSION_EMPTY_METADATA=t.SESSION_EMPTY_STATE=t.SESSION_EMPTY_PERMISSIONS=t.SESSION_EVENTS=t.SESSION_STATUS=t.SESSION_SIGNAL_METHOD_PAIRING=t.SESSION_DEFAULT_TTL=t.SESSION_CONTEXT=t.SESSION_JSONRPC=void 0;const r=n(18);t.SESSION_JSONRPC={propose:"wc_sessionPropose",approve:"wc_sessionApprove",reject:"wc_sessionReject",update:"wc_sessionUpdate",upgrade:"wc_sessionUpgrade",extend:"wc_sessionExtend",delete:"wc_sessionDelete",payload:"wc_sessionPayload",ping:"wc_sessionPing",notification:"wc_sessionNotification"},t.SESSION_CONTEXT="session",t.SESSION_DEFAULT_TTL=r.SEVEN_DAYS,t.SESSION_SIGNAL_METHOD_PAIRING="pairing",t.SESSION_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.SESSION_EVENTS={proposed:"session_proposed",responded:"session_responded",settled:"session_settled",updated:"session_updated",upgraded:"session_upgraded",extended:"session_extended",deleted:"session_deleted",request:"session_request",response:"session_response",sync:"session_sync",notification:"session_notification"},t.SESSION_EMPTY_PERMISSIONS={jsonrpc:{methods:[]},blockchain:{chains:[]},notifications:{types:[]}},t.SESSION_EMPTY_STATE={accounts:[]},t.SESSION_EMPTY_METADATA={name:"",description:"",url:"",icons:[]},t.SESSION_EMPTY_RESPONSE={metadata:t.SESSION_EMPTY_METADATA,state:t.SESSION_EMPTY_STATE}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_EVENTS=void 0,t.STORE_EVENTS={created:"store_created",updated:"store_updated",deleted:"store_deleted",init:"store_init",sync:"store_sync"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_KEYS=t.STORAGE_VERSION=t.STORAGE_CONTEXT=void 0,t.STORAGE_CONTEXT="storage",t.STORAGE_VERSION="0.2",t.STORAGE_KEYS={crypto:{keychain:"crypto:keychain"},session:{pending:"session:pending",settled:"session:settled",history:"session:history",expirer:"session:expirer"},pairing:{pending:"pairing:pending",settled:"pairing:settled",history:"pairing:history",expirer:"pairing:expirer"},relayer:{history:"relayer:history",subscription:"relayer:subscription"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUBSCRIBER_CONTEXT=t.SUBSCRIBER_DEFAULT_TTL=t.SUBSCRIBER_EVENTS=void 0;const r=n(18);t.SUBSCRIBER_EVENTS={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",enabled:"subscription_enabled",disabled:"subscription_disabled",sync:"subscription_sync"},t.SUBSCRIBER_DEFAULT_TTL=r.THIRTY_DAYS,t.SUBSCRIBER_CONTEXT="subscription"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pairing=void 0;const r=n(5),i=n(10),o=n(11),s=n(17),c=n(12),a=n(35),u=n(33),d=n(29),l=n(34),f=n(9);class h extends s.IPairing{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.name=f.PAIRING_CONTEXT,this.config={status:f.PAIRING_STATUS,events:f.PAIRING_EVENTS,jsonrpc:f.PAIRING_JSONRPC},this.logger=o.generateChildLogger(t,this.name),this.pending=new a.Store(e,this.logger,this.config.status.pending),this.settled=new a.Store(e,this.logger,this.config.status.settled),this.history=new d.JsonRpcHistory(this.logger,this.client.storage),this.expirer=new l.Expirer(e,this.logger),this.engine=new u.Engine(this)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init(),yield this.expirer.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t){return this.engine.send(e,t)}get context(){return o.getLoggerContext(this.logger)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}update(e){return this.engine.update(e)}upgrade(e){return this.engine.upgrade(e)}extend(e){return this.engine.extend(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);return{metadata:t.state.metadata||n.state.metadata}}))}mergeUpgrade(e,t){var n,i,o;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{jsonrpc:{methods:c.mergeArrays(r.permissions.jsonrpc.methods,(null===(n=t.permissions.jsonrpc)||void 0===n?void 0:n.methods)||[])},notifications:{types:c.mergeArrays((null===(i=r.permissions.notifications)||void 0===i?void 0:i.types)||[],(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[])},controller:r.permissions.controller}}))}mergeExtension(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);if(t.expiry<=n.expiry){const e=c.ERROR.INVALID_EXTEND_REQUEST.format({context:this.name});throw this.logger.error(e.message),new Error(e.message)}return t}))}validateRespond(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}validateRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}validatePropose(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}getDefaultSignal({topic:e,relay:t,proposer:n}){return r.__awaiter(this,void 0,void 0,(function*(){const r=c.formatUri({protocol:this.client.protocol,version:this.client.version,topic:e,publicKey:n.publicKey,controller:n.controller,relay:t});return{method:f.PAIRING_SIGNAL_METHOD_URI,params:{uri:r}}}))}getDefaultTTL(){return r.__awaiter(this,void 0,void 0,(function*(){return f.PAIRING_DEFAULT_TTL}))}getDefaultPermissions(){return r.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[f.SESSION_JSONRPC.propose]},notifications:{types:[]}}}))}}t.Pairing=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Relayer=void 0;const r=n(5),i=n(10),o=r.__importDefault(n(31)),s=r.__importDefault(n(38)),c=n(11),a=n(17),u=n(12),d=n(138),l=r.__importDefault(n(133)),f=n(8),h=n(82),p=n(9),g=n(29),E=n(83),y=n(80),_=n(81),v=n(135);class R extends a.IRelayer{constructor(e){super(e),this.protocol="irn",this.version=1,this.events=new i.EventEmitter,this.name=p.RELAYER_CONTEXT,this.logger=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?c.generateChildLogger(e.logger,this.name):o.default(c.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||p.RELAYER_DEFAULT_LOGGER}));const t=Object.assign(Object.assign({},p.RELAYER_STORAGE_OPTIONS),null==e?void 0:e.keyValueStorageOptions);this.storage=void 0!==(null==e?void 0:e.storage)?e.storage:new E.RelayerStorage(this.logger,(null==e?void 0:e.keyValueStorage)||new s.default(t),{protocol:this.protocol,version:this.version,context:this.context}),this.heartbeat=(null==e?void 0:e.heartbeat)||new _.HeartBeat({logger:this.logger}),this.encoder=(null==e?void 0:e.encoder)||new y.RelayerEncoder;const n=(null==e?void 0:e.rpcUrl)||u.formatRelayRpcUrl(this.protocol,this.version,p.RELAYER_DEFAULT_RELAY_URL,null==e?void 0:e.projectId);this.provider="string"!=typeof(null==e?void 0:e.relayProvider)&&void 0!==(null==e?void 0:e.relayProvider)?null==e?void 0:e.relayProvider:new d.JsonRpcProvider(new l.default(n)),this.history=new g.JsonRpcHistory(this.logger,this.storage),this.subscriber=new h.Subscriber(this,this.logger),this.publisher=new v.Publisher(this,this.logger),this.registerEventListeners()}get context(){return c.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.history.init(),yield this.provider.connect(),yield this.subscriber.init(),yield this.publisher.init()}))}publish(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){yield this.publisher.publish(e,t,n),yield this.recordPayloadEvent({topic:e,payload:t})}))}subscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return yield this.subscriber.subscribe(e,t)}))}unsubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.subscriber.unsubscribe(e,t)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}recordPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;f.isJsonRpcRequest(n)?yield this.history.set(t,n):yield this.history.resolve(n)}))}shouldIgnorePayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(!this.subscriber.topics.includes(t))return!0;let r=!1;try{if(f.isJsonRpcRequest(n))r=yield this.history.exists(t,n.id);else{let e;try{e=yield this.history.get(t,n.id)}catch(e){}r=void 0!==e&&void 0!==e.response}}catch(e){}return r}))}onPayload(e){return r.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),f.isJsonRpcRequest(e)){if(!e.method.endsWith(p.RELAYER_SUBSCRIBER_SUFFIX))return;const t=e.params,{topic:n,message:r}=t.data,i={topic:n,payload:yield this.encoder.decode(n,r)};if(yield this.shouldIgnorePayloadEvent(i))return;this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Object.assign({type:"event",event:t.id},i)),this.events.emit(t.id,i),this.events.emit(p.RELAYER_EVENTS.payload,i),yield this.acknowledgePayload(e),yield this.recordPayloadEvent(i)}}))}acknowledgePayload(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=f.formatJsonRpcResult(e.id,!0);yield this.provider.connection.send(t)}))}registerEventListeners(){this.provider.on(p.RELAYER_PROVIDER_EVENTS.payload,e=>this.onPayload(e)),this.provider.on(p.RELAYER_PROVIDER_EVENTS.connect,()=>r.__awaiter(this,void 0,void 0,(function*(){this.events.emit(p.RELAYER_EVENTS.connect)}))),this.provider.on(p.RELAYER_PROVIDER_EVENTS.disconnect,()=>r.__awaiter(this,void 0,void 0,(function*(){this.events.emit(p.RELAYER_EVENTS.disconnect),setTimeout(()=>{this.provider.connect()},p.RELAYER_RECONNECT_TIMEOUT)}))),this.provider.on(p.RELAYER_PROVIDER_EVENTS.error,e=>this.events.emit(p.RELAYER_EVENTS.error,e))}}t.Relayer=R},function(e,t,n){"use strict";n.r(t);var r=n(30);n.d(t,"WsConnection",(function(){return r.a})),t.default=r.b},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Publisher=t.IPublisher=void 0;const r=n(5),i=n(10),o=n(11),s=n(12),c=n(136),a=n(9);class u extends c.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}t.IPublisher=u;t.Publisher=class extends u{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new i.EventEmitter,this.name=a.PUBLISHER_CONTEXT,this.queue=new Map,this.relayer=e,this.logger=o.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return o.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}publish(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:n}});try{const r=(null==n?void 0:n.ttl)||a.PUBLISHER_DEFAULT_TTL,i=s.getRelayProtocolName(n),o=(null==n?void 0:n.prompt)||!1,c={topic:e,payload:t,opts:{ttl:r,relay:i,prompt:o}};this.queue.set(t.id,c);const u=yield this.relayer.encoder.encode(e,t);yield this.rpcPublish(e,u,r,i,o),yield this.onPublish(t.id,c),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:n}})}catch(e){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(e),e}}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){}))}rpcPublish(e,t,n,i,o){var c,a;return r.__awaiter(this,void 0,void 0,(function*(){const r={method:s.getRelayProtocolApi(i.protocol).publish,params:{topic:e,message:t,ttl:n,prompt:o}};return void 0===(null===(c=r.params)||void 0===c?void 0:c.prompt)&&(null===(a=r.params)||void 0===a||delete a.prompt),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}))}onPublish(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.queue.delete(e)}))}checkQueue(){this.queue.forEach(e=>r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,opts:{ttl:r,relay:i}}=e,o=yield this.relayer.encoder.encode(t,n);yield this.rpcPublish(t,o,r,i),yield this.onPublish(n.id,e)})))}registerEventListeners(){this.relayer.heartbeat.on(a.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}},function(e,t,n){"use strict";n.r(t);var r=n(84);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(28);n.d(t,"IEvents",(function(){return o.a}));var s=n(85);n.d(t,"IJsonRpcConnection",(function(){return s.b})),n.d(t,"IBaseJsonRpcProvider",(function(){return s.a})),n.d(t,"IJsonRpcProvider",(function(){return s.c}));var c=n(86);for(var i in c)["default","IEvents","IJsonRpcConnection","IBaseJsonRpcProvider","IJsonRpcProvider"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;const r=n(5),i=n(10),o=n(11),s=n(17),c=n(12),a=n(35),u=n(33),d=n(29),l=n(34),f=n(9);class h extends s.ISession{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.name=f.SESSION_CONTEXT,this.config={status:f.SESSION_STATUS,events:f.SESSION_EVENTS,jsonrpc:f.SESSION_JSONRPC},this.logger=o.generateChildLogger(t,this.name),this.pending=new a.Store(e,this.logger,this.config.status.pending),this.settled=new a.Store(e,this.logger,this.config.status.settled),this.history=new d.JsonRpcHistory(this.logger,this.client.storage),this.expirer=new l.Expirer(e,this.logger),this.engine=new u.Engine(this)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init(),yield this.expirer.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t,n){return this.engine.send(e,t,n)}get context(){return o.getLoggerContext(this.logger)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}update(e){return this.engine.update(e)}upgrade(e){return this.engine.upgrade(e)}extend(e){return this.engine.extend(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){var n;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{accounts:(null===(n=t.state)||void 0===n?void 0:n.accounts)||r.state.accounts}}))}mergeUpgrade(e,t){var n,i,o,s,a;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{jsonrpc:{methods:c.mergeArrays(r.permissions.jsonrpc.methods,(null===(n=t.permissions.jsonrpc)||void 0===n?void 0:n.methods)||[])},notifications:{types:c.mergeArrays((null===(i=r.permissions.notifications)||void 0===i?void 0:i.types)||[],(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[])},blockchain:{chains:c.mergeArrays((null===(s=r.permissions.blockchain)||void 0===s?void 0:s.chains)||[],(null===(a=t.permissions.blockchain)||void 0===a?void 0:a.chains)||[])},controller:r.permissions.controller}}))}mergeExtension(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);if(t.expiry<=n.expiry){const e=c.ERROR.INVALID_EXTEND_REQUEST.format({context:this.name});throw this.logger.error(e.message),new Error(e.message)}return t}))}validateRespond(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=c.ERROR.MISSING_OR_INVALID.format({name:"respond params"});throw this.logger.error(e.message),new Error(e.message)}const t=c.validateSessionRespondParams(e);if(c.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message)}))}validateRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=c.ERROR.MISSING_OR_INVALID.format({name:"request params"});throw this.logger.error(e.message),new Error(e.message)}const{topic:t,chainId:n}=e,r=yield this.settled.get(t);if(n&&!r.permissions.blockchain.chains.includes(n)){const e=c.ERROR.UNAUTHORIZED_TARGET_CHAIN.format({chainId:n});throw this.logger.error(e.message),new Error(e.message)}}))}validatePropose(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=c.ERROR.MISSING_OR_INVALID.format({name:"propose params"});throw this.logger.error(e.message),new Error(e.message)}const t=c.validateSessionProposeParams(e);if(c.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message);if(e.signal.method!==f.SESSION_SIGNAL_METHOD_PAIRING){const e=c.ERROR.UNSUPPORTED_SIGNAL.format({context:this.context});throw this.logger.error(e.message),new Error(e.message)}}))}getDefaultSignal(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.client.pairing.settled.get(e.topic);return{method:f.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}}}))}getDefaultTTL(){return r.__awaiter(this,void 0,void 0,(function*(){return f.SESSION_DEFAULT_TTL}))}getDefaultPermissions(){return r.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[]},notifications:{types:[]},blockchain:{chains:[]}}}))}}t.Session=h},function(e,t,n){"use strict";n.r(t),n.d(t,"JsonRpcProvider",(function(){return o}));var r=n(10),i=n(8);class o extends i.IJsonRpcProvider{constructor(e){super(e),this.events=new r.EventEmitter,this.registeredEvents=!1,this.connection=this.setConnection(e)}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Object(i.formatJsonRpcRequest)(e.method,e.params||[]),t)}async requestStrict(e,t){return new Promise(async(n,r)=>{if(!this.connection.connected)try{await this.open()}catch(e){r(e)}this.events.on(""+e.id,e=>{Object(i.isJsonRpcError)(e)?r(e.error.message):n(e.result)});try{await this.connection.send(e,t)}catch(e){r(e)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Object(i.isJsonRpcResponse)(e)?this.events.emit(""+e.id,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof e&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registeredEvents||(this.registeredEvents=!0,this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e))),this.events.emit("connect"))}async close(){await this.connection.close()}}var s=o;t.default=s}])}));